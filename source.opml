<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- OPML generated by OPML Editor v10.1b19 on Fri, 18 Mar 2022 14:26:42 GMT -->
<opml version="2.0">
	<head>
		<title>nodeEditor: daveappserver</title>
		<dateCreated>Thu, 26 Nov 2020 18:41:01 GMT</dateCreated>
		<dateModified>Fri, 18 Mar 2022 14:26:42 GMT</dateModified>
		<ownerName>Dave Winer</ownerName>
		<ownerId>http://davewiner.com/</ownerId>
		<expansionState>1, 2, 3, 13, 63, 66, 67, 69, 71, 73, 95, 97, 99, 101, 102, 103, 106, 107, 116, 118, 131, 135, 163, 164, 165, 167, 168, 190</expansionState>
		<vertScrollState>1</vertScrollState>
		<windowTop>195</windowTop>
		<windowLeft>455</windowLeft>
		<windowBottom>1233</windowBottom>
		<windowRight>1741</windowRight>
		</head>
	<body>
		<outline text="/scripting.com/code/daveappserver/">
			<outline text="package.json">
				<outline text="{">
					<outline text="&quot;name&quot;: &quot;daveappserver&quot;,"/>
					<outline text="&quot;description&quot;: &quot;Factored code that was appearing in all my servers.&quot;,"/>
					<outline text="&quot;version&quot;: &quot;0.5.44&quot;,"/>
					<outline text="&quot;main&quot;: &quot;appserver.js&quot;,"/>
					<outline text="&quot;repository&quot;: {">
						<outline text="&quot;type&quot; : &quot;git&quot;,"/>
						<outline text="&quot;url&quot; : &quot;https://github.com/scripting/appServer&quot;"/>
						<outline text="},"/>
						</outline>
					<outline text="&quot;license&quot;: &quot;MIT&quot;,"/>
					<outline text="&quot;files&quot;: [">
						<outline text="&quot;appserver.js&quot;"/>
						<outline text="],"/>
						</outline>
					<outline text="&quot;dependencies&quot; : {">
						<outline text="&quot;querystring&quot;: &quot;*&quot;,"/>
						<outline text="&quot;request&quot;: &quot;*&quot;,"/>
						<outline text="&quot;nodejs-websocket&quot;: &quot;*&quot;,"/>
						<outline text="&quot;daveutils&quot;: &quot;*&quot;,"/>
						<outline text="&quot;davefilesystem&quot;: &quot;*&quot;,"/>
						<outline text="&quot;foldertojson&quot;: &quot;*&quot;,"/>
						<outline text="&quot;davetwitter&quot;: &quot;*&quot;,"/>
						<outline text="&quot;davezip&quot;: &quot;*&quot;,"/>
						<outline text="&quot;davehttp&quot;: &quot;*&quot;"/>
						<outline text="}"/>
						</outline>
					<outline text="}"/>
					</outline>
				</outline>
			<outline text="appserver.js">
				<outline text="var myVersion = &quot;0.5.44&quot;, myProductName = &quot;daveAppServer&quot;;  " created="Mon, 03 Feb 2014 03:21:03 GMT" pgfnum="36831"/>
				<outline text=""/>
				<outline text="exports.start = startup; "/>
				<outline text="exports.notifySocketSubscribers = notifySocketSubscribers;"/>
				<outline text="exports.saveStats = saveStats;"/>
				<outline text="exports.getStats = getStats; //6/28/21 by DW"/>
				<outline text="exports.getConfig = getConfig;"/>
				<outline text="exports.publishFile = publishFile; //12/13/21 by DW"/>
				<outline text=""/>
				<outline text="const fs = require (&quot;fs&quot;);"/>
				<outline text="var dns = require (&quot;dns&quot;);"/>
				<outline text="var os = require (&quot;os&quot;);"/>
				<outline text="const request = require (&quot;request&quot;);"/>
				<outline text="const websocket = require (&quot;nodejs-websocket&quot;); "/>
				<outline text="const utils = require (&quot;daveutils&quot;);"/>
				<outline text="const davehttp = require (&quot;davehttp&quot;);"/>
				<outline text="const davetwitter = require (&quot;davetwitter&quot;);"/>
				<outline text="const filesystem = require (&quot;davefilesystem&quot;); "/>
				<outline text="const folderToJson = require (&quot;foldertojson&quot;);" created="Sun, 21 Feb 2021 18:12:39 GMT"/>
				<outline text="const zip = require (&quot;davezip&quot;);"/>
				<outline text="const davesql = require (&quot;davesql&quot;);" isComment="true"/>
				<outline text="const opmlToJs = require (&quot;opmltojs&quot;);" isComment="true"/>
				<outline text="const rss = require (&quot;daverss&quot;);" isComment="true"/>
				<outline text="const s3 = require (&quot;daves3&quot;); " isComment="true"/>
				<outline text="const qs = require (&quot;querystring&quot;);"/>
				<outline text=""/>
				<outline text="const whenStart = new Date ();"/>
				<outline text=""/>
				<outline text="var config = {">
					<outline text="productName: &quot;randomApp&quot;,"/>
					<outline text="productNameForDisplay: &quot;Random App&quot;,"/>
					<outline text="version: myVersion,"/>
					<outline text="prefsPath: &quot;prefs.json&quot;,"/>
					<outline text="docsPath: &quot;myDocs/&quot;,"/>
					<outline text="flLogToConsole: true,"/>
					<outline text="port: process.env.PORT || 1420,"/>
					<outline text="websocketPort: 1422,"/>
					<outline text="flAllowAccessFromAnywhere: true,"/>
					<outline text="flPostEnabled: true, //12/21/20 by DW"/>
					<outline text="flWebsocketEnabled: true,"/>
					<outline text="urlServerForClient: &quot;http://tagserver.opml.org/&quot;,"/>
					<outline text="urlWebsocketServerForClient: &quot;ws://tagserver.opml.org:1422/&quot;,"/>
					<outline text="flEnableLogin: true, //user can log in via twitter"/>
					<outline text="blockedAddresses: [], "/>
					<outline text="flForceTwitterLogin: true,"/>
					<outline text=""/>
					<outline text="flStorageEnabled: true,"/>
					<outline text="privateFilesPath: &quot;privateFiles/users/&quot;,"/>
					<outline text="publicFilesPath: &quot;publicFiles/users/&quot;,"/>
					<outline text="" created="Tue, 03 Aug 2021 21:24:46 GMT"/>
					<outline text="defaultContentType: &quot;text/plain&quot;, //8/3/21 by DW" created="Tue, 03 Aug 2021 21:24:46 GMT"/>
					<outline text="" created="Mon, 08 Nov 2021 22:12:08 GMT"/>
					<outline text="userAgent: myProductName + &quot; v&quot; + myVersion //11/8/21 by DW" created="Mon, 08 Nov 2021 22:12:09 GMT"/>
					<outline text="};"/>
					</outline>
				<outline text="const fnameConfig = &quot;config.json&quot;;"/>
				<outline text=""/>
				<outline text="var stats = {">
					<outline text="whenFirstStart: whenStart, ctStarts: 0,"/>
					<outline text="whenLastStart: undefined,"/>
					<outline text="ctWrites: 0,"/>
					<outline text="ctHits: 0, ctHitsToday: 0, ctHitsThisRun:0, "/>
					<outline text="whenLastHit: new Date (0)"/>
					<outline text="};"/>
					</outline>
				<outline text="const fnameStats = &quot;stats.json&quot;;"/>
				<outline text=""/>
				<outline text="" created="Wed, 08 Sep 2021 19:28:21 GMT"/>
				<outline text="function decodeBase64Post (theText) { //9/8/21 by DW" isComment="true" created="Wed, 08 Sep 2021 19:28:22 GMT">
					<outline text="Changes" isComment="true" created="Wed, 08 Sep 2021 19:32:52 GMT">
						<outline text="9/8/21; 3:32:54 PM by DW" created="Wed, 08 Sep 2021 19:32:54 GMT">
							<outline text="The text should begin with something like data:image/png;base64, to get special processing" created="Wed, 08 Sep 2021 19:32:55 GMT"/>
							</outline>
						</outline>
					<outline text="if (utils.beginsWith (theText, &quot;data:image&quot;)) {" created="Wed, 08 Sep 2021 23:19:28 GMT">
						<outline text="var s = theText.replace (/^data:image\/(png|jpg);base64,/, &quot;&quot;);" created="Wed, 08 Sep 2021 23:19:28 GMT"/>
						<outline text="var buffer = Buffer.from (s, &quot;base64&quot;); "/>
						<outline text="return (buffer.toString ());" created="Wed, 08 Sep 2021 19:38:10 GMT"/>
						<outline text="}" created="Wed, 08 Sep 2021 23:20:52 GMT"/>
						</outline>
					<outline text="else {" created="Wed, 08 Sep 2021 23:21:43 GMT">
						<outline text="return (theText);" created="Wed, 08 Sep 2021 19:38:17 GMT"/>
						<outline text="}" created="Wed, 08 Sep 2021 23:21:46 GMT"/>
						</outline>
					<outline text="" isComment="true" created="Wed, 08 Sep 2021 23:19:28 GMT"/>
					<outline text="" isComment="true" created="Wed, 08 Sep 2021 23:19:28 GMT"/>
					<outline text="" isComment="true" created="Wed, 08 Sep 2021 23:19:28 GMT"/>
					<outline text="" isComment="true" created="Wed, 08 Sep 2021 23:19:29 GMT"/>
					<outline text="" isComment="true" created="Wed, 08 Sep 2021 23:19:29 GMT"/>
					<outline text="function pop (lookfor) {" isComment="true" created="Wed, 08 Sep 2021 19:35:02 GMT">
						<outline text="if (utils.beginsWith (s, lookfor)) {" created="Wed, 08 Sep 2021 19:35:12 GMT">
							<outline text="s = utils.stringDelete (s, 1, lookfor.length);" created="Wed, 08 Sep 2021 19:35:47 GMT"/>
							<outline text="return (true);" created="Wed, 08 Sep 2021 19:35:28 GMT"/>
							<outline text="}" created="Wed, 08 Sep 2021 19:35:23 GMT"/>
							</outline>
						<outline text="else {" created="Wed, 08 Sep 2021 19:36:15 GMT">
							<outline text="return (false);" created="Wed, 08 Sep 2021 19:36:17 GMT"/>
							<outline text="}" created="Wed, 08 Sep 2021 19:36:21 GMT"/>
							</outline>
						<outline text="}" created="Wed, 08 Sep 2021 19:36:23 GMT"/>
						</outline>
					<outline text="if (pop (&quot;data:&quot;)) {" isComment="true" created="Wed, 08 Sep 2021 19:29:46 GMT">
						<outline text="var type = utils.stringNthField (s, &quot;;&quot;, 1); " created="Wed, 08 Sep 2021 19:31:12 GMT"/>
						<outline text="s = utils.stringDelete (s, 1, type.length + 1);" created="Wed, 08 Sep 2021 19:30:39 GMT"/>
						<outline text="if (pop (&quot;base64,&quot;)) {" created="Wed, 08 Sep 2021 19:34:37 GMT">
							<outline text="var buffer = Buffer.from (s, &quot;base64&quot;); "/>
							<outline text="return (buffer.toString ());" created="Wed, 08 Sep 2021 19:38:10 GMT"/>
							<outline text="}" created="Wed, 08 Sep 2021 19:37:22 GMT"/>
							</outline>
						<outline text="}" created="Wed, 08 Sep 2021 19:47:09 GMT"/>
						</outline>
					<outline text="return (theText);" isComment="true" created="Wed, 08 Sep 2021 19:38:17 GMT"/>
					<outline text="}" created="Wed, 08 Sep 2021 19:28:40 GMT"/>
					</outline>
				<outline text="function statsChanged () {">
					<outline text="flStatsChanged = true;"/>
					<outline text="}"/>
					</outline>
				<outline text="function saveStats (theStats) {">
					<outline text="for (var x in theStats) {">
						<outline text="stats [x] = theStats [x];"/>
						<outline text="}"/>
						</outline>
					<outline text="statsChanged ();"/>
					<outline text="}"/>
					</outline>
				<outline text="function getStats () { //6/28/21 by DW">
					<outline text="return (stats);"/>
					<outline text="}"/>
					</outline>
				<outline text="function getConfig () {">
					<outline text="return (config);"/>
					<outline text="}"/>
					</outline>
				<outline text="function httpReadUrl (url, callback) {" created="Mon, 20 Jan 2014 17:26:34 GMT" pgfnum="36035">
					<outline text="request (url, function (err, response, data) {">
						<outline text="if (err) {">
							<outline text="callback (err);"/>
							<outline text="}"/>
							</outline>
						<outline text="else {">
							<outline text="if (response.statusCode != 200) {">
								<outline text="const errstruct = {">
									<outline text="message: &quot;Can't read the URL, \&quot;&quot; + url + &quot;\&quot; because we received a status code of &quot; + response.statusCode + &quot;.&quot;,"/>
									<outline text="statusCode: response.statusCode"/>
									<outline text="};"/>
									</outline>
								<outline text="callback (errstruct);"/>
								<outline text="}"/>
								</outline>
							<outline text="else {">
								<outline text="callback (undefined, data);"/>
								<outline text="}"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="});"/>
						</outline>
					<outline text="}" created="Mon, 20 Jan 2014 17:26:49 GMT" pgfnum="36038"/>
					</outline>
				<outline text="function httpFullRequest (jsontext, callback) { //11/5/21 by DW" created="Fri, 05 Nov 2021 15:09:20 GMT">
					<outline text="Changes" isComment="true" created="Fri, 05 Nov 2021 15:12:12 GMT">
						<outline text="11/8/21; 8:43:44 AM by DW" created="Mon, 08 Nov 2021 13:43:44 GMT">
							<outline text="Include data in the errstruct we return for a statusCode that is not 200." created="Mon, 08 Nov 2021 13:43:45 GMT"/>
							<outline text="Don't call it an error if the error code is 201 through 299. GitHub returns 204, as reported by Scott Hanson." created="Mon, 08 Nov 2021 13:49:53 GMT">
								<outline text="https://github.com/scripting/appServer/blob/main/appserver.js" created="Mon, 08 Nov 2021 13:50:23 GMT"/>
								</outline>
							</outline>
						<outline text="11/5/21; 11:12:16 AM by DW" created="Fri, 05 Nov 2021 15:12:15 GMT">
							<outline text="Send me a struct with the parameters for a request call and we'll do it and return the result. " created="Fri, 05 Nov 2021 15:15:42 GMT"/>
							</outline>
						</outline>
					<outline text="var theRequest;" created="Fri, 05 Nov 2021 16:04:56 GMT"/>
					<outline text="function isErrorStatusCode (theCode) { //11/8/21 by DW" created="Mon, 08 Nov 2021 13:45:39 GMT">
						<outline text="return ((theCode &lt; 200) || (theCode &gt; 299));" created="Mon, 08 Nov 2021 13:49:01 GMT"/>
						<outline text="}" created="Mon, 08 Nov 2021 13:45:50 GMT"/>
						</outline>
					<outline text="try {" created="Fri, 05 Nov 2021 16:04:56 GMT">
						<outline text="theRequest = JSON.parse (jsontext);" created="Fri, 05 Nov 2021 16:04:23 GMT"/>
						<outline text="}" created="Fri, 05 Nov 2021 16:05:01 GMT"/>
						</outline>
					<outline text="catch (err) {" created="Fri, 05 Nov 2021 16:05:02 GMT">
						<outline text="callback (err);" created="Fri, 05 Nov 2021 16:05:14 GMT"/>
						<outline text="return;" created="Fri, 05 Nov 2021 16:05:19 GMT"/>
						<outline text="}" created="Fri, 05 Nov 2021 16:05:06 GMT"/>
						</outline>
					<outline text="request (theRequest, function (err, response, data) {">
						<outline text="if (err) {">
							<outline text="callback (err);"/>
							<outline text="}"/>
							</outline>
						<outline text="else {">
							<outline text="if (isErrorStatusCode (response.statusCode)) { //11/8/21 by DW">
								<outline text="const errstruct = {">
									<outline text="message: &quot;Can't read the URL, \&quot;&quot; + theRequest.url + &quot;\&quot; because we received a status code of &quot; + response.statusCode + &quot;.&quot;,"/>
									<outline text="statusCode: response.statusCode,"/>
									<outline text="data //11/8/21 by DW" created="Mon, 08 Nov 2021 13:44:25 GMT"/>
									<outline text="};"/>
									</outline>
								<outline text="callback (errstruct);"/>
								<outline text="}"/>
								</outline>
							<outline text="else {">
								<outline text="callback (undefined, data);"/>
								<outline text="}"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="});"/>
						</outline>
					<outline text="}" created="Fri, 05 Nov 2021 15:09:32 GMT"/>
					</outline>
				<outline text="function checkPathForIllegalChars (path) {">
					<outline text="Changes" isComment="true">
						<outline text="5/10/15; 7:08:13 PM by DW">
							<outline text="* is legal."/>
							</outline>
						</outline>
					<outline text="function isIllegal (ch) {">
						<outline text="if (utils.isAlpha (ch) || utils.isNumeric (ch)) {">
							<outline text="return (false);"/>
							<outline text="}"/>
							</outline>
						<outline text="switch (ch) {">
							<outline text="case &quot;/&quot;: case &quot;_&quot;: case &quot;-&quot;: case &quot;.&quot;:  case &quot; &quot;: case &quot;*&quot;:">
								<outline text="return (false);"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="return (true);"/>
						<outline text="}"/>
						</outline>
					<outline text="for (var i = 0; i &lt; path.length; i++) {">
						<outline text="if (isIllegal (path [i])) {">
							<outline text="return (false);"/>
							<outline text="}"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="if (utils.stringContains (path, &quot;./&quot;)) {">
						<outline text="return (false);"/>
						<outline text="}"/>
						</outline>
					<outline text="return (true);"/>
					<outline text="}"/>
					</outline>
				<outline text="function getDomainName (clientIp, callback) { //11/14/15 by DW">
					<outline text="if (clientIp === undefined) {">
						<outline text="if (callback !== undefined) {">
							<outline text="callback (&quot;undefined&quot;);"/>
							<outline text="}"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="else {">
						<outline text="dns.reverse (clientIp, function (err, domains) {">
							<outline text="var name = clientIp;"/>
							<outline text="if (!err) {">
								<outline text="if (domains.length &gt; 0) {">
									<outline text="name = domains [0];"/>
									<outline text="}"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text="if (callback !== undefined) {">
								<outline text="callback (name);"/>
								<outline text="}"/>
								</outline>
							<outline text="});"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="}"/>
					</outline>
				<outline text="function getDomainNameVerb (clientIp, callback) { //2/27/21 by DW" created="Sat, 27 Feb 2021 16:54:08 GMT">
					<outline text="Changes" isComment="true" created="Sat, 27 Feb 2021 16:59:51 GMT">
						<outline text="2/27/21; 11:59:56 AM by DW" created="Sat, 27 Feb 2021 16:59:55 GMT">
							<outline text="Called from a user script on a client machine. Uses the standard callback interface. " created="Sat, 27 Feb 2021 16:59:57 GMT"/>
							</outline>
						</outline>
					<outline text="dns.reverse (clientIp, function (err, domains) {">
						<outline text="if (err) {" created="Sat, 27 Feb 2021 17:00:43 GMT">
							<outline text="callback (err);" created="Sat, 27 Feb 2021 17:00:52 GMT"/>
							<outline text="}" created="Sat, 27 Feb 2021 17:00:45 GMT"/>
							</outline>
						<outline text="else {" created="Sat, 27 Feb 2021 17:00:46 GMT">
							<outline text="var name = (domains.length &gt; 0) ? name = domains [0] : clientIp;" created="Sat, 27 Feb 2021 17:01:31 GMT"/>
							<outline text="callback (undefined, {name});"/>
							<outline text="}" created="Sat, 27 Feb 2021 17:00:48 GMT"/>
							</outline>
						<outline text="});"/>
						</outline>
					<outline text="}" created="Sat, 27 Feb 2021 16:54:33 GMT"/>
					</outline>
				<outline text="function getDottedIdVerb (name, callback) { //2/27/21 by DW" created="Sat, 27 Feb 2021 17:20:47 GMT">
					<outline text="dns.lookup (name, null, function (err, dottedid) {">
						<outline text="if (err) {">
							<outline text="callback (err);" created="Sat, 27 Feb 2021 17:22:48 GMT"/>
							<outline text="}"/>
							</outline>
						<outline text="else {">
							<outline text="callback (undefined, {dottedid});" created="Sat, 27 Feb 2021 17:23:17 GMT"/>
							<outline text="}"/>
							</outline>
						<outline text="});"/>
						</outline>
					<outline text="}" created="Sat, 27 Feb 2021 17:20:58 GMT"/>
					</outline>
				<outline text="function cleanFileStats (stats) { //4/19/21 by DW" created="Mon, 19 Apr 2021 13:42:19 GMT">
					<outline text="function formatDate (d) {" created="Thu, 01 Apr 2021 14:36:30 GMT">
						<outline text="return (new Date (d).toUTCString ());" created="Thu, 01 Apr 2021 14:36:38 GMT"/>
						<outline text="}" created="Thu, 01 Apr 2021 14:36:51 GMT"/>
						</outline>
					<outline text="var cleanStats = {" created="Mon, 19 Apr 2021 13:43:04 GMT">
						<outline text="size: stats.size, //number of bytes in file"/>
						<outline text="whenAccessed: formatDate (stats.atime), //when last red"/>
						<outline text="whenCreated: formatDate (stats.birthtime)," created="Sun, 21 Feb 2021 21:39:45 GMT"/>
						<outline text="whenModified: formatDate (stats.mtime)," created="Sun, 21 Feb 2021 21:39:01 GMT"/>
						<outline text="flPrivate: stats.flPrivate" created="Thu, 01 Apr 2021 14:32:14 GMT"/>
						<outline text="}" created="Mon, 19 Apr 2021 13:43:21 GMT"/>
						</outline>
					<outline text="return (cleanStats);" created="Mon, 19 Apr 2021 13:43:25 GMT"/>
					<outline text="}" created="Mon, 19 Apr 2021 13:42:24 GMT"/>
					</outline>
				<outline text=""/>
				<outline text="//sockets">
					<outline text="var theWsServer = undefined;"/>
					<outline text=""/>
					<outline text="function notifySocketSubscribers (verb, payload, flPayloadIsString, callbackToQualify) {">
						<outline text="Changes" isComment="true" created="Sat, 06 Mar 2021 17:36:54 GMT">
							<outline text="3/6/21; 12:36:58 PM by DW" created="Sat, 06 Mar 2021 17:36:56 GMT">
								<outline text="New optional param, flPayloadIsString. If true we don't treat the payload as if it were a JS object. " created="Sat, 06 Mar 2021 17:36:58 GMT"/>
								<outline text="New optional param, callbackToQualify, if specified we call it on each connection, if it returns true it qualifies to be notified" created="Sat, 06 Mar 2021 20:22:29 GMT"/>
								</outline>
							</outline>
						<outline text="if (theWsServer !== undefined) {">
							<outline text="var ctUpdates = 0, now = new Date (), ctTotalSockets = 0;"/>
							<outline text="if (payload !== undefined) { ">
								<outline text="if (!flPayloadIsString) {" created="Sat, 06 Mar 2021 17:38:36 GMT">
									<outline text="payload = utils.jsonStringify (payload);"/>
									<outline text="}" created="Sat, 06 Mar 2021 17:38:42 GMT"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text="theWsServer.connections.forEach (function (conn, ix) {">
								<outline text="ctTotalSockets++;" created="Sat, 06 Mar 2021 20:35:11 GMT"/>
								<outline text="if (conn.appData !== undefined) { //it's one of ours">
									<outline text="var flnotify = true;" created="Sat, 06 Mar 2021 20:23:38 GMT"/>
									<outline text="if (callbackToQualify !== undefined) {" created="Sat, 06 Mar 2021 20:23:48 GMT">
										<outline text="flnotify = callbackToQualify (conn);" created="Sat, 06 Mar 2021 20:23:59 GMT"/>
										<outline text="}" created="Sat, 06 Mar 2021 20:23:53 GMT"/>
										</outline>
									<outline text="if (flnotify) {" created="Sat, 06 Mar 2021 20:24:14 GMT">
										<outline text="try {">
											<outline text="conn.sendText (verb + &quot;\r&quot; + payload);"/>
											<outline text="conn.appData.whenLastUpdate = now;"/>
											<outline text="conn.appData.ctUpdates++;"/>
											<outline text="ctUpdates++;"/>
											<outline text="}"/>
											</outline>
										<outline text="catch (err) {">
											<outline text="console.log (&quot;notifySocketSubscribers: socket #&quot; + i + &quot;: error updating&quot;);"/>
											<outline text="}"/>
											</outline>
										<outline text="}" created="Sat, 06 Mar 2021 20:24:17 GMT"/>
										</outline>
									<outline text="}"/>
									</outline>
								<outline text="});"/>
								</outline>
							<outline text="console.log (&quot;\nnotifySocketSubscribers: &quot; + ctUpdates + &quot; of &quot; + ctTotalSockets + &quot; sockets were updated.\n&quot;);" isComment="true"/>
							<outline text="}"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="function checkWebSocketCalls () { //expire timed-out calls">
						<outline text="}"/>
						</outline>
					<outline text="function countOpenSockets () {">
						<outline text="if (theWsServer === undefined) { //12/18/15 by DW">
							<outline text="return (0);"/>
							<outline text="}"/>
							</outline>
						<outline text="else {">
							<outline text="return (theWsServer.connections.length);"/>
							<outline text="}"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="function getOpenSocketsArray () { //return an array with data about open sockets">
						<outline text="var theArray = new Array ();"/>
						<outline text="theWsServer.connections.forEach (function (conn, ix) {">
							<outline text="if (conn.appData !== undefined) { //it's one of ours">
								<outline text="theArray.push ({">
									<outline text="arrayIndex: ix,"/>
									<outline text="lastVerb: conn.appData.lastVerb,"/>
									<outline text="urlToWatch: conn.appData.urlToWatch,"/>
									<outline text="domain: conn.appData.domain,"/>
									<outline text="whenStarted: utils.viewDate (conn.appData.whenStarted),"/>
									<outline text="whenLastUpdate: utils.viewDate (conn.appData.whenLastUpdate)"/>
									<outline text="});"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text="});"/>
							</outline>
						<outline text="return (theArray);"/>
						<outline text="" isComment="true"/>
						<outline text="for (var i = 0; i &lt; theWsServer.connections.length; i++) {" isComment="true">
							<outline text="var conn = theWsServer.connections [i];"/>
							<outline text="if (conn.chatLogData !== undefined) { //it's one of ours">
								<outline text="theArray [theArray.length] = {">
									<outline text="arrayIndex: i,"/>
									<outline text="lastVerb: conn.chatLogData.lastVerb,"/>
									<outline text="urlToWatch: conn.chatLogData.urlToWatch,"/>
									<outline text="domain: conn.chatLogData.domain,"/>
									<outline text="whenStarted: utils.viewDate (conn.chatLogData.whenStarted),"/>
									<outline text="whenLastUpdate: utils.viewDate (conn.chatLogData.whenLastUpdate)"/>
									<outline text="};"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="function handleWebSocketConnection (conn) { ">
						<outline text="var now = new Date ();"/>
						<outline text="console.log (&quot;handleWebSocketConnection: conn.socket.remoteAddress == &quot; + conn.socket.remoteAddress); //6/7/21 by DW" isComment="true" created="Mon, 07 Jun 2021 17:25:37 GMT"/>
						<outline text="conn.appData = { //initialize">
							<outline text="whenStarted: now,"/>
							<outline text="ctUpdates: 0,"/>
							<outline text="whenLastUpdate: new Date (0),"/>
							<outline text="lastVerb: undefined,"/>
							<outline text="urlToWatch: undefined,"/>
							<outline text="domain: undefined"/>
							<outline text="};"/>
							</outline>
						<outline text=""/>
						<outline text="function logToConsole (conn, verb, value) {">
							<outline text="getDomainName (conn.socket.remoteAddress, function (theName) { //log the request">
								<outline text="var freemem = utils.gigabyteString (os.freemem ()), method = &quot;WS:&quot; + verb, now = new Date (); "/>
								<outline text="if (theName === undefined) {">
									<outline text="theName = conn.socket.remoteAddress;"/>
									<outline text="}"/>
									</outline>
								<outline text="console.log (now.toLocaleTimeString () + &quot; &quot; + freemem + &quot; &quot; + method + &quot; &quot; + value + &quot; &quot; + theName);"/>
								<outline text="conn.appData.domain = theName; "/>
								<outline text="});"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="" created="Tue, 14 Dec 2021 22:21:22 GMT"/>
						<outline text="function kissOtherLogonsGoodnight (screenname, theNewConnection) { //12/14/21 by DW" created="Tue, 14 Dec 2021 22:21:23 GMT">
							<outline text="Changes" isComment="true" created="Tue, 14 Dec 2021 22:21:48 GMT">
								<outline text="12/14/21; 5:21:51 PM by DW" created="Tue, 14 Dec 2021 22:21:50 GMT">
									<outline text="Loop over the other instances with the same screenname, and tell them to have a good night. " created="Tue, 14 Dec 2021 22:21:51 GMT"/>
									</outline>
								</outline>
							<outline text="theWsServer.connections.forEach (function (conn, ix) {">
								<outline text="if (conn.appData !== undefined) { //it's one of ours">
									<outline text="if (conn != theNewConnection) { //it's not the new one" created="Tue, 14 Dec 2021 22:26:03 GMT">
										<outline text="if (conn.appData.screenname == screenname) {" created="Tue, 14 Dec 2021 22:23:36 GMT">
											<outline text="conn.sendText (&quot;goodnight&quot;);"/>
											<outline text="}" created="Tue, 14 Dec 2021 22:23:50 GMT"/>
											</outline>
										<outline text="}" created="Tue, 14 Dec 2021 22:26:10 GMT"/>
										</outline>
									<outline text="}"/>
									</outline>
								<outline text="});"/>
								</outline>
							<outline text="}" created="Tue, 14 Dec 2021 22:21:30 GMT"/>
							</outline>
						<outline text=""/>
						<outline text="conn.on (&quot;text&quot;, function (s) {">
							<outline text="var words = s.split (&quot; &quot;);"/>
							<outline text="console.log (&quot;handleWebSocketConnection: s == &quot; + s); //6/7/21 by DW" isComment="true" created="Mon, 07 Jun 2021 17:25:37 GMT"/>
							<outline text="if (words.length &gt; 1) { //new protocol as of 11/29/15 by DW">
								<outline text="conn.appData.whenLastUpdate = now;"/>
								<outline text="conn.appData.lastVerb = words [0];"/>
								<outline text="switch (words [0]) {">
									<outline text="case &quot;watch&quot;:">
										<outline text="conn.appData.urlToWatch = utils.trimWhitespace (words [1]);"/>
										<outline text="logToConsole (conn, conn.appData.lastVerb, conn.appData.urlToWatch);"/>
										<outline text="break;"/>
										</outline>
									<outline text="" created="Wed, 29 Sep 2021 17:05:23 GMT"/>
									<outline text="case &quot;user&quot;: //9/29/21 by DW" created="Wed, 29 Sep 2021 17:05:23 GMT">
										<outline text="var token = words [1], secret = words [2];" created="Wed, 29 Sep 2021 17:06:15 GMT"/>
										<outline text="conn.appData.twOauthToken = token;" created="Wed, 29 Sep 2021 17:06:15 GMT"/>
										<outline text="conn.appData.twOauthTokenSecret = secret;" created="Wed, 29 Sep 2021 17:06:15 GMT"/>
										<outline text="conn.appData.urlToWatch = &quot;&quot;;" created="Wed, 29 Sep 2021 17:12:17 GMT"/>
										<outline text="davetwitter.getScreenName (token, secret, function (screenname) {" created="Wed, 09 Jul 2014 23:57:16 GMT" pgfnum="42784">
											<outline text="conn.appData.screenname = screenname;" created="Wed, 29 Sep 2021 17:09:07 GMT"/>
											<outline text="kissOtherLogonsGoodnight (screenname, conn); //12/14/21 by DW" created="Tue, 14 Dec 2021 22:20:44 GMT"/>
											<outline text="logToConsole (conn, conn.appData.lastVerb, conn.appData.screenname);"/>
											<outline text="});" created="Wed, 09 Jul 2014 23:57:25 GMT" pgfnum="42785"/>
											</outline>
										<outline text="break;"/>
										</outline>
									<outline text="" created="Wed, 29 Sep 2021 17:05:23 GMT"/>
									<outline text="}"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text="else {">
								<outline text="conn.close ();"/>
								<outline text="}"/>
								</outline>
							<outline text="});"/>
							</outline>
						<outline text="conn.on (&quot;close&quot;, function () {">
							<outline text="console.log (&quot;'close' message received.&quot;);" isComment="true"/>
							<outline text="});"/>
							</outline>
						<outline text="conn.on (&quot;error&quot;, function (err) {">
							<outline text="logToConsole (conn, &quot;error&quot;, err.code);" isComment="true"/>
							<outline text="conn.close (); //11/30/15 by DW -- https://github.com/scripting/betterWebSocketsDemo/issues/2#issuecomment-160658118" isComment="true"/>
							<outline text="});"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="function webSocketStartup () {">
						<outline text="if (config.flWebsocketEnabled) {">
							<outline text="try {">
								<outline text="theWsServer = websocket.createServer (handleWebSocketConnection);"/>
								<outline text="theWsServer = websocket.createServer (function (conn) {" isComment="true">
									<outline text="conn.bingeworthyData = {">
										<outline text="whenLastUpdate: new Date (0),"/>
										<outline text="ctUpdates: 0"/>
										<outline text="};"/>
										</outline>
									<outline text="});"/>
									</outline>
								<outline text="console.log (&quot;webSocketStartup: config.websocketPort == &quot; + config.websocketPort);"/>
								<outline text="theWsServer.listen (config.websocketPort);"/>
								<outline text="}"/>
								</outline>
							<outline text="catch (err) {">
								<outline text="console.log (&quot;webSocketStartup: err.message == &quot; + err.message);"/>
								<outline text="}"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="}"/>
						</outline>
					</outline>
				<outline text="//storage functions">
					<outline text="function getFilePath (screenname, relpath, flprivate) {">
						<outline text="const folder = (flprivate) ? config.privateFilesPath : config.publicFilesPath;"/>
						<outline text="const f = folder + screenname + &quot;/&quot; + relpath;"/>
						<outline text="return (f);"/>
						<outline text="}"/>
						</outline>
					<outline text="function findFile (screenname, relpath, callback) { //4/1/21 by DW" created="Thu, 01 Apr 2021 14:18:43 GMT">
						<outline text="Changes" isComment="true" created="Thu, 01 Apr 2021 14:19:09 GMT">
							<outline text="4/1/21; 10:19:11 AM by DW" created="Thu, 01 Apr 2021 14:19:10 GMT">
								<outline text="First look for the public version of the file, then the private, then not found." created="Thu, 01 Apr 2021 14:19:12 GMT"/>
								</outline>
							</outline>
						<outline text="var f = getFilePath (screenname, relpath, false); //public version"/>
						<outline text="fs.stat (f, function (err, stats) {" created="Thu, 01 Apr 2021 14:20:52 GMT">
							<outline text="if (err) {" created="Thu, 01 Apr 2021 14:21:14 GMT">
								<outline text="f = getFilePath (screenname, relpath, true); //private version"/>
								<outline text="fs.stat (f, function (err, stats) {" created="Thu, 01 Apr 2021 14:20:52 GMT">
									<outline text="if (err) {" created="Thu, 01 Apr 2021 14:21:14 GMT">
										<outline text="callback (err);" created="Thu, 01 Apr 2021 14:21:54 GMT"/>
										<outline text="}" created="Thu, 01 Apr 2021 14:21:18 GMT"/>
										</outline>
									<outline text="else {" created="Thu, 01 Apr 2021 14:21:22 GMT">
										<outline text="stats.flPrivate = true;" created="Thu, 01 Apr 2021 14:30:57 GMT"/>
										<outline text="callback (undefined, stats);" created="Thu, 01 Apr 2021 14:22:02 GMT"/>
										<outline text="}" created="Thu, 01 Apr 2021 14:21:25 GMT"/>
										</outline>
									<outline text="});" created="Thu, 01 Apr 2021 14:21:01 GMT"/>
									</outline>
								<outline text="}" created="Thu, 01 Apr 2021 14:21:18 GMT"/>
								</outline>
							<outline text="else {" created="Thu, 01 Apr 2021 14:21:22 GMT">
								<outline text="stats.flPrivate = false;" created="Thu, 01 Apr 2021 14:30:57 GMT"/>
								<outline text="callback (undefined, stats);" created="Thu, 01 Apr 2021 14:22:02 GMT"/>
								<outline text="}" created="Thu, 01 Apr 2021 14:21:25 GMT"/>
								</outline>
							<outline text="});" created="Thu, 01 Apr 2021 14:21:01 GMT"/>
							</outline>
						<outline text="}" created="Thu, 01 Apr 2021 14:19:01 GMT"/>
						</outline>
					<outline text="function publishFile (screenname, relpath, type, flprivate, filetext, callback) {">
						<outline text="if (config.flStorageEnabled) {">
							<outline text="var f = getFilePath (screenname, relpath, flprivate);"/>
							<outline text="utils.sureFilePath (f, function () {">
								<outline text="var now = new Date ();"/>
								<outline text="fs.writeFile (f, filetext, function (err) {">
									<outline text="if (err) {">
										<outline text="callback (err);"/>
										<outline text="}"/>
										</outline>
									<outline text="else {">
										<outline text="var url = (flprivate) ? undefined : config.urlServerForClient + screenname + &quot;/&quot; + relpath;"/>
										<outline text="if (config.publishFile !== undefined) { //3/18/22 by DW" created="Fri, 18 Mar 2022 14:17:52 GMT">
											<outline text="config.publishFile (f, screenname, relpath, type, flprivate, filetext, url);" created="Fri, 18 Mar 2022 14:18:30 GMT"/>
											<outline text="}" created="Fri, 18 Mar 2022 14:18:18 GMT"/>
											</outline>
										<outline text="if (!flprivate) {">
											<outline text="notifySocketSubscribers (&quot;update&quot;, filetext, true, function (conn) { //3/6/2 by DW -- payload is a string">
												<outline text="console.log (&quot;publishFile: conn.appData.urlToWatch == &quot; + conn.appData.urlToWatch + &quot;, url == &quot; + url); " isComment="true" created="Sat, 06 Mar 2021 20:19:09 GMT"/>
												<outline text="if (conn.appData.urlToWatch == url) {" created="Sat, 06 Mar 2021 20:25:13 GMT">
													<outline text="return (true);" created="Sat, 06 Mar 2021 20:25:20 GMT"/>
													<outline text="}" created="Sat, 06 Mar 2021 20:25:19 GMT"/>
													</outline>
												<outline text="else {" created="Sat, 06 Mar 2021 20:25:26 GMT">
													<outline text="return (false);" created="Sat, 06 Mar 2021 20:25:28 GMT"/>
													<outline text="}" created="Sat, 06 Mar 2021 20:25:31 GMT"/>
													</outline>
												<outline text="});" created="Sat, 06 Mar 2021 20:24:58 GMT"/>
												</outline>
											<outline text="}"/>
											</outline>
										<outline text="callback (undefined, {">
											<outline text="url,"/>
											<outline text="whenLastUpdate: now"/>
											<outline text="});"/>
											</outline>
										<outline text="}"/>
										</outline>
									<outline text="});"/>
									</outline>
								<outline text="});"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="else {">
							<outline text="callback ({message: &quot;Can't publish the file because the feature is not enabled on the server.&quot;});"/>
							<outline text="}"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="function getFile (screenname, relpath, flprivate, callback) {">
						<outline text="Changes" isComment="true">
							<outline text="4/19/21; 9:44:22 AM by DW" created="Mon, 19 Apr 2021 13:44:22 GMT">
								<outline text="We now return file stats along with the file data." created="Mon, 19 Apr 2021 13:44:23 GMT"/>
								</outline>
							<outline text="7/28/15; 4:14:27 PM by DW">
								<outline text="Cribbed from storage.getObject in nodeStorage. "/>
								<outline text="On an error, if the code is ENOENT, we change it to the code that S3 would return, NoSuchKey. This is what the API is looking for, because in some circumstances this is not an error. For example the first time the app launches, and we're trying to get the user's appPrefs.json file. If it doesn't exist, we create one. "/>
								</outline>
							</outline>
						<outline text="function errcallback (err) {" created="Mon, 19 Apr 2021 13:38:45 GMT">
							<outline text="if (err.code == &quot;ENOENT&quot;) {">
								<outline text="err.status = 500;"/>
								<outline text="err.code = &quot;NoSuchKey&quot;;"/>
								<outline text="}"/>
								</outline>
							<outline text="callback (err);"/>
							<outline text="}" created="Mon, 19 Apr 2021 13:38:50 GMT"/>
							</outline>
						<outline text="if (config.flStorageEnabled) {">
							<outline text="var f = getFilePath (screenname, relpath, flprivate);"/>
							<outline text="fs.readFile (f, function (err, filetext) {">
								<outline text="if (err) {">
									<outline text="errcallback (err);"/>
									<outline text="}"/>
									</outline>
								<outline text="else {">
									<outline text="fs.stat (f, function (err, stats) {" created="Mon, 19 Apr 2021 13:36:27 GMT">
										<outline text="if (err) {" created="Mon, 19 Apr 2021 13:36:49 GMT">
											<outline text="errcallback (err);"/>
											<outline text="}" created="Mon, 19 Apr 2021 13:36:52 GMT"/>
											</outline>
										<outline text="else {" created="Mon, 19 Apr 2021 13:36:59 GMT">
											<outline text="var data = {" created="Mon, 19 Apr 2021 13:39:52 GMT">
												<outline text="filedata: filetext.toString ()," created="Mon, 19 Apr 2021 13:40:09 GMT"/>
												<outline text="filestats: cleanFileStats (stats)" created="Mon, 19 Apr 2021 13:41:55 GMT"/>
												<outline text="};" created="Mon, 19 Apr 2021 13:40:00 GMT"/>
												</outline>
											<outline text="callback (undefined, data);"/>
											<outline text="}" created="Mon, 19 Apr 2021 13:37:02 GMT"/>
											</outline>
										<outline text="});" created="Mon, 19 Apr 2021 13:36:38 GMT"/>
										</outline>
									<outline text="}"/>
									</outline>
								<outline text="});"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="else {">
							<outline text="callback ({message: &quot;Can't publish the file because the feature is not enabled on the server.&quot;});"/>
							<outline text="}"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="function getFileList (screenname, flprivate, callback) {">
						<outline text="var folder = getFilePath (screenname, &quot;&quot;, flprivate);"/>
						<outline text="filesystem.getFolderInfo (folder, function (theList) {">
							<outline text="var returnedList = new Array ();"/>
							<outline text="theList.forEach (function (item) {">
								<outline text="var fname = utils.stringLastField (item.f, &quot;/&quot;);"/>
								<outline text="if (fname != &quot;.DS_Store&quot;) {">
									<outline text="returnedList.push ({">
										<outline text="path: utils.stringDelete (item.f, 1, folder.length),"/>
										<outline text="whenLastChange: item.whenModified,"/>
										<outline text="whenCreated: item.whenCreated,"/>
										<outline text="ctChars: item.size"/>
										<outline text="});"/>
										</outline>
									<outline text="}"/>
									</outline>
								<outline text="});"/>
								</outline>
							<outline text="console.log (&quot;getFileList: folder == &quot; + folder + &quot;, returnedList == &quot; + utils.jsonStringify (returnedList));" isComment="true"/>
							<outline text="if (callback != undefined) {">
								<outline text="callback (undefined, returnedList);"/>
								<outline text="}"/>
								</outline>
							<outline text="});"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="" created="Sat, 04 Dec 2021 18:53:56 GMT"/>
					<outline text="function getPublicFileUrl (screenname, relpath) { //12/4/21 by DW" created="Sat, 04 Dec 2021 18:53:56 GMT">
						<outline text="var urlpublic = config.urlServerForClient + screenname + &quot;/&quot; + relpath;"/>
						<outline text="return (urlpublic);" created="Sat, 04 Dec 2021 18:54:30 GMT"/>
						<outline text="}" created="Sat, 04 Dec 2021 18:54:09 GMT"/>
						</outline>
					<outline text="" created="Sat, 04 Dec 2021 18:53:57 GMT"/>
					<outline text="function makeFilePublic (screenname, relpath, callback) { //2/20/21 by DW" created="Sat, 20 Feb 2021 16:24:56 GMT">
						<outline text="Changes" isComment="true" created="Sat, 20 Feb 2021 16:23:04 GMT">
							<outline text="2/20/21; 11:23:07 AM by DW" created="Sat, 20 Feb 2021 16:23:06 GMT">
								<outline text="Implements the file.makeFilePublic verb. First we try to read the file as a public file, if it works, we return the public URL of the file. If it doesn't work, we try to read the private file, if it works, we save the file as a public file, deleting the original file if it worked. " created="Sat, 20 Feb 2021 16:23:07 GMT"/>
								</outline>
							</outline>
						<outline text="console.log (&quot;makeFilePublic: relpath == &quot; + relpath);" created="Sat, 20 Feb 2021 16:45:18 GMT"/>
						<outline text="getFile (screenname, relpath, false, function (err, data) {" created="Sat, 20 Feb 2021 16:26:12 GMT">
							<outline text="var urlpublic = config.urlServerForClient + screenname + &quot;/&quot; + relpath;"/>
							<outline text="if (err) { //public file doesn't exist, read the private file" created="Sat, 20 Feb 2021 16:26:53 GMT">
								<outline text="getFile (screenname, relpath, true, function (err, filetext) {" created="Sat, 20 Feb 2021 16:29:30 GMT">
									<outline text="if (err) { //file not there, can't make the file public" created="Sat, 20 Feb 2021 16:29:48 GMT">
										<outline text="var message = &quot;Can't make the file public because we can't read the private file.&quot;;" created="Sat, 20 Feb 2021 16:30:23 GMT"/>
										<outline text="console.log (&quot;makeFilePublic: err.message == &quot; + err.message);" created="Sat, 20 Feb 2021 16:30:06 GMT"/>
										<outline text="callback ({message});" created="Sat, 20 Feb 2021 16:30:06 GMT"/>
										<outline text="}" created="Sat, 20 Feb 2021 16:29:50 GMT"/>
										</outline>
									<outline text="else {" created="Sat, 20 Feb 2021 16:29:51 GMT">
										<outline text="publishFile (screenname, relpath, &quot;text/plain&quot;, false, filetext, function (err, data) {" created="Sat, 20 Feb 2021 16:31:05 GMT">
											<outline text="if (err) {" created="Sat, 20 Feb 2021 16:32:42 GMT">
												<outline text="var message = &quot;Can't make the file public because we can't write the new file.&quot;;" created="Sat, 20 Feb 2021 16:30:23 GMT"/>
												<outline text="callback ({message});" created="Sat, 20 Feb 2021 16:30:06 GMT"/>
												<outline text="}" created="Sat, 20 Feb 2021 16:32:45 GMT"/>
												</outline>
											<outline text="else {" created="Sat, 20 Feb 2021 16:32:45 GMT">
												<outline text="callback (undefined, {url: urlpublic});" created="Sat, 20 Feb 2021 16:27:13 GMT"/>
												<outline text="}" created="Sat, 20 Feb 2021 16:32:47 GMT"/>
												</outline>
											<outline text="});" created="Sat, 20 Feb 2021 16:32:36 GMT"/>
											</outline>
										<outline text="}" created="Sat, 20 Feb 2021 16:29:53 GMT"/>
										</outline>
									<outline text="});" created="Sat, 20 Feb 2021 16:29:38 GMT"/>
									</outline>
								<outline text="}" created="Sat, 20 Feb 2021 16:26:55 GMT"/>
								</outline>
							<outline text="else { //it exists, return the public url of the file" created="Sat, 20 Feb 2021 16:26:57 GMT">
								<outline text="callback (undefined, {url: urlpublic});" created="Sat, 20 Feb 2021 16:27:13 GMT"/>
								<outline text="}" created="Sat, 20 Feb 2021 16:26:58 GMT"/>
								</outline>
							<outline text="});" created="Sat, 20 Feb 2021 16:26:40 GMT"/>
							</outline>
						<outline text="}" created="Sat, 20 Feb 2021 16:25:23 GMT"/>
						</outline>
					<outline text="function getFileHierarchy (screenname, callback) { //2/21/21 by DW" created="Sun, 21 Feb 2021 20:42:39 GMT">
						<outline text="folderToJson.getObject (config.privateFilesPath + screenname + &quot;/&quot;, function (err, privateSubs) {" created="Sun, 21 Feb 2021 17:47:28 GMT">
							<outline text="if (err) {" created="Sun, 21 Feb 2021 17:47:46 GMT">
								<outline text="callback (err);" created="Sun, 21 Feb 2021 17:47:49 GMT"/>
								<outline text="}" created="Sun, 21 Feb 2021 17:47:52 GMT"/>
								</outline>
							<outline text="else {" created="Sun, 21 Feb 2021 17:47:53 GMT">
								<outline text="folderToJson.getObject (config.publicFilesPath + screenname + &quot;/&quot;, function (err, publicSubs) {" created="Sun, 21 Feb 2021 17:47:28 GMT">
									<outline text="function legitError (err) {" created="Sat, 04 Dec 2021 19:16:17 GMT">
										<outline text="if (err) {" created="Sat, 04 Dec 2021 19:16:51 GMT">
											<outline text="if (err.code == &quot;ENOENT&quot;) {" created="Sat, 04 Dec 2021 19:17:08 GMT">
												<outline text="publicSubs = new Object ();" created="Sat, 04 Dec 2021 19:23:10 GMT"/>
												<outline text="return (false);" created="Sat, 04 Dec 2021 19:17:41 GMT"/>
												<outline text="}" created="Sat, 04 Dec 2021 19:17:22 GMT"/>
												</outline>
											<outline text="else {" created="Sat, 04 Dec 2021 19:19:21 GMT">
												<outline text="return (true);" created="Sat, 04 Dec 2021 19:18:52 GMT"/>
												<outline text="}" created="Sat, 04 Dec 2021 19:19:23 GMT"/>
												</outline>
											<outline text="}" created="Sat, 04 Dec 2021 19:17:28 GMT"/>
											</outline>
										<outline text="else {" created="Sat, 04 Dec 2021 19:17:36 GMT">
											<outline text="return (false);" created="Sat, 04 Dec 2021 19:17:41 GMT"/>
											<outline text="}" created="Sat, 04 Dec 2021 19:17:45 GMT"/>
											</outline>
										<outline text="}" created="Sat, 04 Dec 2021 19:16:26 GMT"/>
										</outline>
									<outline text="if (legitError (err)) {" created="Sun, 21 Feb 2021 17:47:46 GMT">
										<outline text="callback (err);" created="Sun, 21 Feb 2021 17:47:49 GMT"/>
										<outline text="}" created="Sun, 21 Feb 2021 17:47:52 GMT"/>
										</outline>
									<outline text="else {" created="Sun, 21 Feb 2021 17:47:53 GMT">
										<outline text="var theHierarchy = {" created="Mon, 22 Feb 2021 17:24:17 GMT">
											<outline text="publicFiles: {" created="Mon, 22 Feb 2021 17:24:37 GMT">
												<outline text="subs: publicSubs" created="Mon, 22 Feb 2021 17:24:45 GMT"/>
												<outline text="}," created="Mon, 22 Feb 2021 17:24:50 GMT"/>
												</outline>
											<outline text="privateFiles: {" created="Mon, 22 Feb 2021 17:24:38 GMT">
												<outline text="subs: privateSubs" created="Mon, 22 Feb 2021 17:24:56 GMT"/>
												<outline text="}" created="Mon, 22 Feb 2021 17:24:59 GMT"/>
												</outline>
											<outline text="};" created="Mon, 22 Feb 2021 17:24:27 GMT"/>
											</outline>
										<outline text="callback (undefined, theHierarchy);" created="Sun, 21 Feb 2021 17:47:55 GMT"/>
										<outline text="}" created="Sun, 21 Feb 2021 17:48:06 GMT"/>
										</outline>
									<outline text="});" created="Sun, 21 Feb 2021 17:47:37 GMT"/>
									</outline>
								<outline text="}" created="Sun, 21 Feb 2021 17:48:06 GMT"/>
								</outline>
							<outline text="});" created="Sun, 21 Feb 2021 17:47:37 GMT"/>
							</outline>
						<outline text="}" created="Sun, 21 Feb 2021 20:43:15 GMT"/>
						</outline>
					<outline text="function deleteFile (screenname, relpath, callback) { //2/23/21 by DW">
						<outline text="Changes" isComment="true" created="Tue, 23 Feb 2021 16:05:23 GMT">
							<outline text="2/23/21; 11:05:26 AM by DW" created="Tue, 23 Feb 2021 16:05:25 GMT">
								<outline text="We try to delete both the public and private versions. If neither succeeds we call it an error, otherwise it's cool." created="Tue, 23 Feb 2021 16:05:26 GMT"/>
								</outline>
							</outline>
						<outline text="if (config.flStorageEnabled) {">
							<outline text="function deleteone (flprivate, callback) {" created="Tue, 23 Feb 2021 16:01:47 GMT">
								<outline text="var f = getFilePath (screenname, relpath, flprivate);"/>
								<outline text="fs.unlink (f, callback);" created="Tue, 23 Feb 2021 16:02:15 GMT"/>
								<outline text="}" created="Tue, 23 Feb 2021 16:01:58 GMT"/>
								</outline>
							<outline text="deleteone (true, function (errPrivate) {" created="Tue, 23 Feb 2021 15:59:48 GMT">
								<outline text="deleteone (false, function (errPublic) {" created="Tue, 23 Feb 2021 16:00:34 GMT">
									<outline text="if (errPrivate &amp;&amp; errPublic) {" created="Tue, 23 Feb 2021 16:03:50 GMT">
										<outline text="callback ({message: &quot;Can't delete the file because it doesn't exist.&quot;});" created="Tue, 23 Feb 2021 16:04:11 GMT"/>
										<outline text="}" created="Tue, 23 Feb 2021 16:03:58 GMT"/>
										</outline>
									<outline text="else {" created="Tue, 23 Feb 2021 16:04:43 GMT">
										<outline text="callback (undefined);" created="Tue, 23 Feb 2021 16:04:46 GMT"/>
										<outline text="}" created="Tue, 23 Feb 2021 16:04:50 GMT"/>
										</outline>
									<outline text="});" created="Tue, 23 Feb 2021 16:03:45 GMT"/>
									</outline>
								<outline text="});" created="Tue, 23 Feb 2021 16:00:06 GMT"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="else {">
							<outline text="callback ({message: &quot;Can't delete the file because the feature is not enabled on the server.&quot;});"/>
							<outline text="}"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="function fileExists (screenname, relpath, callback) { //5/29/21 by DW" created="Wed, 24 Feb 2021 20:18:01 GMT">
						<outline text="Changes" isComment="true" created="Sat, 29 May 2021 15:24:47 GMT">
							<outline text="5/29/21; 11:24:51 AM by DW" created="Sat, 29 May 2021 15:24:49 GMT">
								<outline text="Read the file, if no error, file exists. " created="Sat, 29 May 2021 15:24:51 GMT"/>
								</outline>
							</outline>
						<outline text="readWholeFile (screenname, relpath, function (err, data) {" created="Sat, 29 May 2021 15:23:16 GMT">
							<outline text="var flExists = err === undefined;" created="Sat, 29 May 2021 15:33:57 GMT"/>
							<outline text="callback (undefined, {flExists});" created="Sat, 29 May 2021 15:24:03 GMT"/>
							<outline text="});" created="Sat, 29 May 2021 15:23:38 GMT"/>
							</outline>
						<outline text="}" created="Wed, 24 Feb 2021 20:18:17 GMT"/>
						</outline>
					<outline text="function readWholeFile (screenname, relpath, callback) { //2/24/21 by DW" created="Wed, 24 Feb 2021 20:18:01 GMT">
						<outline text="Changes" isComment="true" created="Wed, 24 Feb 2021 20:24:55 GMT">
							<outline text="2/24/21; 3:24:58 PM by DW" created="Wed, 24 Feb 2021 20:24:57 GMT">
								<outline text="First we try to read the public version, if it exists we return the text of the file. Otherwise we read the private version, if that fails we return an error." created="Wed, 24 Feb 2021 20:24:58 GMT"/>
								<outline text="This was written as the backend for the file.readWholeFile scripting verb. " created="Wed, 24 Feb 2021 20:26:00 GMT"/>
								</outline>
							</outline>
						<outline text="if (config.flStorageEnabled) {">
							<outline text="function readone (flprivate, callback) {" created="Tue, 23 Feb 2021 16:01:47 GMT">
								<outline text="var f = getFilePath (screenname, relpath, flprivate);"/>
								<outline text="fs.readFile (f, function (err, filetext) {" created="Tue, 23 Feb 2021 16:02:15 GMT">
									<outline text="if (err) {" created="Wed, 24 Feb 2021 20:23:25 GMT">
										<outline text="callback (err);" created="Wed, 24 Feb 2021 20:23:27 GMT"/>
										<outline text="}" created="Wed, 24 Feb 2021 20:23:31 GMT"/>
										</outline>
									<outline text="else {" created="Wed, 24 Feb 2021 20:23:31 GMT">
										<outline text="filetext = filetext.toString (); //it's a buffer" created="Wed, 24 Feb 2021 20:41:38 GMT"/>
										<outline text="callback (undefined, {filetext});" created="Wed, 24 Feb 2021 20:23:33 GMT"/>
										<outline text="}" created="Wed, 24 Feb 2021 20:23:41 GMT"/>
										</outline>
									<outline text="});" created="Wed, 24 Feb 2021 20:23:20 GMT"/>
									</outline>
								<outline text="}" created="Tue, 23 Feb 2021 16:01:58 GMT"/>
								</outline>
							<outline text="readone (false, function (err, fileinfo) { //look for public version first" created="Tue, 23 Feb 2021 15:59:48 GMT">
								<outline text="if (err) {" created="Wed, 24 Feb 2021 20:20:27 GMT">
									<outline text="readone (true, function (err, fileinfo) { //look for private version" created="Tue, 23 Feb 2021 16:00:34 GMT">
										<outline text="if (err) {" created="Tue, 23 Feb 2021 16:03:50 GMT">
											<outline text="callback ({message: &quot;Can't read the file because it doesn't exist.&quot;});" created="Tue, 23 Feb 2021 16:04:11 GMT"/>
											<outline text="}" created="Tue, 23 Feb 2021 16:03:58 GMT"/>
											</outline>
										<outline text="else {" created="Tue, 23 Feb 2021 16:04:43 GMT">
											<outline text="callback (undefined, fileinfo);" created="Tue, 23 Feb 2021 16:04:46 GMT"/>
											<outline text="}" created="Tue, 23 Feb 2021 16:04:50 GMT"/>
											</outline>
										<outline text="});" created="Tue, 23 Feb 2021 16:03:45 GMT"/>
										</outline>
									<outline text="}" created="Wed, 24 Feb 2021 20:20:37 GMT"/>
									</outline>
								<outline text="else {" created="Wed, 24 Feb 2021 20:20:38 GMT">
									<outline text="callback (undefined, fileinfo);" created="Tue, 23 Feb 2021 16:04:46 GMT"/>
									<outline text="}" created="Wed, 24 Feb 2021 20:20:42 GMT"/>
									</outline>
								<outline text="});" created="Tue, 23 Feb 2021 16:00:06 GMT"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="else {">
							<outline text="callback ({message: &quot;Can't read the file because the feature is not enabled on the server.&quot;});"/>
							<outline text="}"/>
							</outline>
						<outline text="}" created="Wed, 24 Feb 2021 20:18:17 GMT"/>
						</outline>
					<outline text="function storageMustBeEnabled (namefunction, httpReturn, callback) {" created="Thu, 25 Feb 2021 17:34:14 GMT">
						<outline text="if (config.flStorageEnabled) {" created="Thu, 25 Feb 2021 17:34:41 GMT">
							<outline text="callback ();" created="Thu, 25 Feb 2021 17:35:00 GMT"/>
							<outline text="}" created="Thu, 25 Feb 2021 17:34:52 GMT"/>
							</outline>
						<outline text="else {" created="Thu, 25 Feb 2021 17:35:03 GMT">
							<outline text="httpReturn ({message: &quot;Can't &quot; + namefunction + &quot; the file because the feature is not enabled on the server.&quot;});"/>
							<outline text="}" created="Thu, 25 Feb 2021 17:35:06 GMT"/>
							</outline>
						<outline text="}" created="Thu, 25 Feb 2021 17:34:31 GMT"/>
						</outline>
					<outline text="function writeWholeFile (screenname, relpath, filetext, callback) {" created="Thu, 25 Feb 2021 17:31:37 GMT">
						<outline text="Changes" isComment="true" created="Thu, 25 Feb 2021 17:32:22 GMT">
							<outline text="9/15/21; 10:04:46 AM by DW" created="Wed, 15 Sep 2021 14:04:46 GMT">
								<outline text="Before writing the file make sure the folder path to the file exists. " created="Wed, 15 Sep 2021 14:04:46 GMT"/>
								</outline>
							<outline text="2/25/21; 12:32:24 PM by DW" created="Thu, 25 Feb 2021 17:32:23 GMT">
								<outline text="If the file doesn't exist, we create a private file."/>
								<outline text="If it does exist, we replace the first one we find."/>
								<outline text="We start looking for the public file, then the private one. "/>
								</outline>
							</outline>
						<outline text="storageMustBeEnabled (&quot;write&quot;, callback, function () {" created="Thu, 25 Feb 2021 17:33:40 GMT">
							<outline text="function readone (flprivate, callback) {" created="Tue, 23 Feb 2021 16:01:47 GMT">
								<outline text="var f = getFilePath (screenname, relpath, flprivate);"/>
								<outline text="fs.readFile (f, function (err, filetext) {" created="Tue, 23 Feb 2021 16:02:15 GMT">
									<outline text="if (err) {" created="Wed, 24 Feb 2021 20:23:25 GMT">
										<outline text="callback (err);" created="Wed, 24 Feb 2021 20:23:27 GMT"/>
										<outline text="}" created="Wed, 24 Feb 2021 20:23:31 GMT"/>
										</outline>
									<outline text="else {" created="Wed, 24 Feb 2021 20:23:31 GMT">
										<outline text="filetext = filetext.toString (); //it's a buffer" created="Wed, 24 Feb 2021 20:41:38 GMT"/>
										<outline text="callback (undefined, {filetext});" created="Wed, 24 Feb 2021 20:23:33 GMT"/>
										<outline text="}" created="Wed, 24 Feb 2021 20:23:41 GMT"/>
										</outline>
									<outline text="});" created="Wed, 24 Feb 2021 20:23:20 GMT"/>
									</outline>
								<outline text="}" created="Tue, 23 Feb 2021 16:01:58 GMT"/>
								</outline>
							<outline text="function writethefile (flprivate) {" created="Thu, 25 Feb 2021 17:38:57 GMT">
								<outline text="var f = getFilePath (screenname, relpath, flprivate);"/>
								<outline text="utils.sureFilePath (f, function () { //9/15/21 by DW" created="Wed, 15 Sep 2021 14:03:42 GMT">
									<outline text="fs.writeFile (f, filetext, function (err) {" created="Thu, 25 Feb 2021 17:39:25 GMT">
										<outline text="if (err) {" created="Thu, 25 Feb 2021 17:40:20 GMT">
											<outline text="callback (err);" created="Thu, 25 Feb 2021 17:40:23 GMT"/>
											<outline text="}" created="Thu, 25 Feb 2021 17:40:28 GMT"/>
											</outline>
										<outline text="else {" created="Thu, 25 Feb 2021 17:40:29 GMT">
											<outline text="if (config.publishFile !== undefined) { //3/18/22 by DW" created="Fri, 18 Mar 2022 14:17:52 GMT">
												<outline text="var url = (flprivate) ? undefined : config.urlServerForClient + screenname + &quot;/&quot; + relpath;"/>
												<outline text="config.publishFile (f, screenname, relpath, type, flprivate, filetext, url);" created="Fri, 18 Mar 2022 14:18:30 GMT"/>
												<outline text="}" created="Fri, 18 Mar 2022 14:18:18 GMT"/>
												</outline>
											<outline text="callback (undefined);" created="Thu, 25 Feb 2021 17:40:31 GMT"/>
											<outline text="}" created="Thu, 25 Feb 2021 17:48:22 GMT"/>
											</outline>
										<outline text="});" created="Thu, 25 Feb 2021 17:40:00 GMT"/>
										</outline>
									<outline text="});" created="Wed, 15 Sep 2021 14:04:05 GMT"/>
									</outline>
								<outline text="}" created="Thu, 25 Feb 2021 17:39:04 GMT"/>
								</outline>
							<outline text="readone (false, function (err, data) {" created="Thu, 25 Feb 2021 17:36:35 GMT">
								<outline text="if (err) { //write a private file" created="Thu, 25 Feb 2021 17:37:16 GMT">
									<outline text="writethefile (true);" created="Thu, 25 Feb 2021 17:37:33 GMT"/>
									<outline text="}" created="Thu, 25 Feb 2021 17:37:24 GMT"/>
									</outline>
								<outline text="else { //public version exists" created="Thu, 25 Feb 2021 17:37:25 GMT">
									<outline text="writethefile (false);" created="Thu, 25 Feb 2021 17:37:33 GMT"/>
									<outline text="}" created="Thu, 25 Feb 2021 17:37:28 GMT"/>
									</outline>
								<outline text="});" created="Thu, 25 Feb 2021 17:37:04 GMT"/>
								</outline>
							<outline text="});" created="Thu, 25 Feb 2021 17:34:07 GMT"/>
							</outline>
						<outline text="}" created="Thu, 25 Feb 2021 17:32:00 GMT"/>
						</outline>
					<outline text="function getPublicUrl (screenname, relpath) { //8/24/21 by DW" created="Tue, 24 Aug 2021 14:27:52 GMT">
						<outline text="return (config.urlServerForClient + screenname + &quot;/&quot; + relpath);"/>
						<outline text="}" created="Tue, 24 Aug 2021 14:28:05 GMT"/>
						</outline>
					<outline text="function getFileInfo (screenname, relpath, callback) { //4/1/21 by DW" created="Thu, 01 Apr 2021 14:14:47 GMT">
						<outline text="Changes" isComment="true" created="Tue, 24 Aug 2021 14:24:28 GMT">
							<outline text="8/24/21; 10:24:30 AM by DW" created="Tue, 24 Aug 2021 14:24:29 GMT">
								<outline text="If the file is public return the address of the file." created="Tue, 24 Aug 2021 14:24:31 GMT"/>
								</outline>
							</outline>
						<outline text="if (config.flStorageEnabled) {">
							<outline text="findFile (screenname, relpath, function (err, stats) {" created="Thu, 01 Apr 2021 14:23:00 GMT">
								<outline text="if (err) {" created="Thu, 01 Apr 2021 14:23:27 GMT">
									<outline text="callback (err);" created="Thu, 01 Apr 2021 14:23:30 GMT"/>
									<outline text="}" created="Thu, 01 Apr 2021 14:23:34 GMT"/>
									</outline>
								<outline text="else {" created="Thu, 01 Apr 2021 14:23:34 GMT">
									<outline text="function formatDate (d) {" created="Thu, 01 Apr 2021 14:36:30 GMT">
										<outline text="return (new Date (d).toUTCString ());" created="Thu, 01 Apr 2021 14:36:38 GMT"/>
										<outline text="}" created="Thu, 01 Apr 2021 14:36:51 GMT"/>
										</outline>
									<outline text="callback (undefined, {" created="Thu, 01 Apr 2021 14:23:59 GMT">
										<outline text="size: stats.size, //number of bytes in file"/>
										<outline text="whenAccessed: formatDate (stats.atime), //when last red"/>
										<outline text="whenCreated: formatDate (stats.birthtime)," created="Sun, 21 Feb 2021 21:39:45 GMT"/>
										<outline text="whenModified: formatDate (stats.mtime)," created="Sun, 21 Feb 2021 21:39:01 GMT"/>
										<outline text="flPrivate: stats.flPrivate," created="Thu, 01 Apr 2021 14:32:14 GMT"/>
										<outline text="urlPublic: (stats.flPrivate) ? undefined : getPublicUrl (screenname, relpath) //8/24/21 by DW" created="Tue, 24 Aug 2021 14:25:27 GMT"/>
										<outline text="});" created="Thu, 01 Apr 2021 14:24:04 GMT"/>
										</outline>
									<outline text="}" created="Thu, 01 Apr 2021 14:23:36 GMT"/>
									</outline>
								<outline text="});" created="Thu, 01 Apr 2021 14:23:22 GMT"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="else {">
							<outline text="callback ({message: &quot;Can't read the file because the feature is not enabled on the server.&quot;});"/>
							<outline text="}"/>
							</outline>
						<outline text="}" created="Thu, 01 Apr 2021 14:15:03 GMT"/>
						</outline>
					<outline text="function getUserData (screenname, callback) { //4/14/20 by DW">
						<outline text="storageMustBeEnabled (&quot;get user data&quot;, callback, function () {" created="Thu, 25 Feb 2021 17:33:40 GMT">
							<outline text="const tmpfolder = &quot;tmp/&quot;, archivefile = tmpfolder + screenname + &quot;.zip&quot;; "/>
							<outline text="utils.sureFilePath (archivefile, function () {">
								<outline text="var theArchive = zip.createArchive (archivefile, function (err, data) {">
									<outline text="if (callback !== undefined) {">
										<outline text="callback (err, archivefile);"/>
										<outline text="}"/>
										</outline>
									<outline text="});"/>
									</outline>
								<outline text="var pathPublicFiles = getFilePath (screenname, &quot;&quot;, false);"/>
								<outline text="var pathPrivateFiles = getFilePath (screenname, &quot;&quot;, true);"/>
								<outline text="var pathPublicFiles = s3Path + &quot;users/&quot; + screenName + &quot;/&quot;;" isComment="true"/>
								<outline text="var pathPrivateFiles = s3PrivatePath + &quot;users/&quot; + screenName + &quot;/&quot;;" isComment="true"/>
								<outline text="console.log (&quot;archiveUser: pathPublicFiles == &quot; + pathPublicFiles);" isComment="true"/>
								<outline text="theArchive.addDirectoryToArchive (pathPublicFiles, &quot;Public Files&quot;);"/>
								<outline text="theArchive.addDirectoryToArchive (pathPrivateFiles, &quot;Private Files&quot;);"/>
								<outline text="theArchive.finalize ();"/>
								<outline text="});"/>
								</outline>
							<outline text="});" created="Thu, 25 Feb 2021 17:34:07 GMT"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="" isComment="true" created="Sun, 04 Apr 2021 17:18:49 GMT"/>
					<outline text="function getOptionalPublicOrPrivateFile (screenname, relpath, callback) { //4/4/21 by DW" isComment="true" created="Sun, 04 Apr 2021 17:18:50 GMT">
						<outline text="if (config.flStorageEnabled) {">
							<outline text="function readone (flprivate, callback) {" created="Tue, 23 Feb 2021 16:01:47 GMT">
								<outline text="var f = getFilePath (screenname, relpath, flprivate);"/>
								<outline text="fs.readFile (f, function (err, filetext) {" created="Tue, 23 Feb 2021 16:02:15 GMT">
									<outline text="if (err) {" created="Wed, 24 Feb 2021 20:23:25 GMT">
										<outline text="callback (err);" created="Wed, 24 Feb 2021 20:23:27 GMT"/>
										<outline text="}" created="Wed, 24 Feb 2021 20:23:31 GMT"/>
										</outline>
									<outline text="else {" created="Wed, 24 Feb 2021 20:23:31 GMT">
										<outline text="filetext = filetext.toString (); //it's a buffer" created="Wed, 24 Feb 2021 20:41:38 GMT"/>
										<outline text="callback (undefined, {filetext});" created="Wed, 24 Feb 2021 20:23:33 GMT"/>
										<outline text="}" created="Wed, 24 Feb 2021 20:23:41 GMT"/>
										</outline>
									<outline text="});" created="Wed, 24 Feb 2021 20:23:20 GMT"/>
									</outline>
								<outline text="}" created="Tue, 23 Feb 2021 16:01:58 GMT"/>
								</outline>
							<outline text="readone (false, function (err, fileinfo) { //look for public version first" created="Tue, 23 Feb 2021 15:59:48 GMT">
								<outline text="if (err) {" created="Wed, 24 Feb 2021 20:20:27 GMT">
									<outline text="readone (true, function (err, fileinfo) { //look for private version" created="Tue, 23 Feb 2021 16:00:34 GMT">
										<outline text="if (err) {" created="Tue, 23 Feb 2021 16:03:50 GMT">
											<outline text="callback ({message: &quot;Can't read the file because it doesn't exist.&quot;});" created="Tue, 23 Feb 2021 16:04:11 GMT"/>
											<outline text="}" created="Tue, 23 Feb 2021 16:03:58 GMT"/>
											</outline>
										<outline text="else {" created="Tue, 23 Feb 2021 16:04:43 GMT">
											<outline text="callback (undefined, fileinfo);" created="Tue, 23 Feb 2021 16:04:46 GMT"/>
											<outline text="}" created="Tue, 23 Feb 2021 16:04:50 GMT"/>
											</outline>
										<outline text="});" created="Tue, 23 Feb 2021 16:03:45 GMT"/>
										</outline>
									<outline text="}" created="Wed, 24 Feb 2021 20:20:37 GMT"/>
									</outline>
								<outline text="else {" created="Wed, 24 Feb 2021 20:20:38 GMT">
									<outline text="callback (undefined, fileinfo);" created="Tue, 23 Feb 2021 16:04:46 GMT"/>
									<outline text="}" created="Wed, 24 Feb 2021 20:20:42 GMT"/>
									</outline>
								<outline text="});" created="Tue, 23 Feb 2021 16:00:06 GMT"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="else {">
							<outline text="callback ({message: &quot;Can't read the file because the feature is not enabled on the server.&quot;});"/>
							<outline text="}"/>
							</outline>
						<outline text="}" created="Sun, 04 Apr 2021 17:19:08 GMT"/>
						</outline>
					</outline>
				<outline text="//github -- 11/8/21 by DW" created="Mon, 08 Nov 2021 21:45:09 GMT">
					<outline text="function handleGithubOauthCallback (theCode, callback) { //11/8/21 by DW">
						<outline text="Changes" isComment="true" created="Mon, 08 Nov 2021 17:18:01 GMT">
							<outline text="11/8/21; 12:18:03 PM by DW" created="Mon, 08 Nov 2021 17:18:02 GMT">
								<outline text="Cribbed from githubpub." created="Mon, 08 Nov 2021 17:18:03 GMT"/>
								</outline>
							</outline>
						<outline text="var params = {">
							<outline text="client_id: config.githubClientId,"/>
							<outline text="client_secret: config.githubClientSecret,"/>
							<outline text="code: theCode"/>
							<outline text="};"/>
							</outline>
						<outline text="var apiUrl = &quot;https://github.com/login/oauth/access_token?&quot; + utils.buildParamList (params);"/>
						<outline text="var githubRequest = {">
							<outline text="method: &quot;POST&quot;,"/>
							<outline text="url: apiUrl"/>
							<outline text="followRedirect: true, " isComment="true"/>
							<outline text="headers: {Accept: &quot;application/json&quot;}" isComment="true"/>
							<outline text="};"/>
							</outline>
						<outline text="console.log (&quot;handleGithubOauthCallback: githubRequest === &quot; + utils.jsonStringify (githubRequest));"/>
						<outline text="request (githubRequest, function (err, response, body) {">
							<outline text="if (err) {">
								<outline text="console.log (&quot;handleGithubOauthCallback: err.message == &quot; + err.message);"/>
								<outline text="callback (err);" created="Mon, 08 Nov 2021 17:33:37 GMT"/>
								<outline text="}"/>
								</outline>
							<outline text="else {">
								<outline text="var postbody = qs.parse (body);"/>
								<outline text="var urlRedirect = &quot;/?githubaccesstoken=&quot; + postbody.access_token;"/>
								<outline text="console.log (&quot;handleGithubOauthCallback: urlRedirect = &quot; + urlRedirect);"/>
								<outline text="callback (undefined, urlRedirect);" created="Mon, 08 Nov 2021 17:38:59 GMT"/>
								<outline text="}"/>
								</outline>
							<outline text="});"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="function downloadFromGithub (username, repository, path, accessToken, callback) { //calls back with the JSON structure GitHub returns">
						<outline text="Changes" isComment="true">
							<outline text="11/8/21; 4:45:52 PM by DW" created="Mon, 08 Nov 2021 21:45:52 GMT">
								<outline text="Cribbed from githubpub." created="Mon, 08 Nov 2021 21:45:53 GMT"/>
								</outline>
							<outline text="12/13/19; 11:09:44 AM by DW">
								<outline text="New option, flCanUseCache. "/>
								</outline>
							<outline text="10/29/18; 10:48:35 AM by DW">
								<outline text="New optional param, options, which contains accessToken to begin."/>
								</outline>
							</outline>
						<outline text="if (!utils.beginsWith (path, &quot;/&quot;)) {">
							<outline text="path = &quot;/&quot; + path;"/>
							<outline text="}"/>
							</outline>
						<outline text="var url = &quot;https://api.github.com/repos/&quot; + username + &quot;/&quot; + repository + &quot;/contents&quot; + path;"/>
						<outline text="url += &quot;?client_id=&quot; + config.githubClientId + &quot;&amp;client_secret=&quot; + config.githubClientSecret;" isComment="true"/>
						<outline text="var theRequest = {">
							<outline text="url: url,"/>
							<outline text="jar: true, //&quot;remember cookies for future use&quot;"/>
							<outline text="maxRedirects: 5,"/>
							<outline text="headers: {">
								<outline text="&quot;User-Agent&quot;: config.userAgent,"/>
								<outline text="&quot;Authorization&quot;: &quot;token &quot; + accessToken"/>
								<outline text="}"/>
								</outline>
							<outline text="};"/>
							</outline>
						<outline text="request (theRequest, function (err, response, jsontext) {">
							<outline text="if (err) {">
								<outline text="callback (err);"/>
								<outline text="}"/>
								</outline>
							<outline text="else {">
								<outline text="if (response.statusCode == 404) {">
									<outline text="callback ({message: &quot;The file \&quot;&quot; + path + &quot;\&quot; was not found.&quot;});"/>
									<outline text="}"/>
									</outline>
								<outline text="else {">
									<outline text="console.log (&quot;downloadFromGithub: response.headers == &quot; + utils.jsonStringify (response.headers))" isComment="true"/>
									<outline text="if (response.headers [&quot;x-ratelimit-remaining&quot;] == 0) {">
										<outline text="var theLimit = response.headers [&quot;x-ratelimit-limit&quot;];"/>
										<outline text="callback ({&quot;message&quot;: &quot;GitHub reported a rate limit error. You are limited to &quot; + theLimit + &quot; calls per hour.&quot;});"/>
										<outline text="}"/>
										</outline>
									<outline text="else {">
										<outline text="try {">
											<outline text="var jstruct = JSON.parse (jsontext);"/>
											<outline text="callback (undefined, jstruct);"/>
											<outline text="}"/>
											</outline>
										<outline text="catch (err) {">
											<outline text="callback (err);"/>
											<outline text="}"/>
											</outline>
										<outline text="}"/>
										</outline>
									<outline text="}"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text="});"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="function uploadToGithub (jsontext, data, callback) {">
						<outline text="Changes" isComment="true">
							<outline text="11/9/21; 3:30:18 PM by DW">
								<outline text="jsontext is the serialized options struct. " created="Tue, 09 Nov 2021 20:37:27 GMT"/>
								<outline text="required elements">
									<outline text="username, repository, path, data, type, accessToken -- required" created="Tue, 09 Nov 2021 20:22:50 GMT"/>
									</outline>
								<outline text="optional elements" created="Tue, 09 Nov 2021 20:37:48 GMT">
									<outline text="type -- optional, the mime type for the data, if not provided we infer it from the extension" created="Tue, 09 Nov 2021 20:40:35 GMT"/>
									<outline text="message -- optional, the checkin message"/>
									<outline text="committer -- optional, a struct with name and email of the committer"/>
									<outline text="userAgent -- optional"/>
									</outline>
								</outline>
							</outline>
						<outline text="var options;" created="Tue, 09 Nov 2021 20:35:15 GMT"/>
						<outline text="try {" created="Tue, 09 Nov 2021 20:35:16 GMT">
							<outline text="options = JSON.parse (jsontext);" created="Tue, 09 Nov 2021 20:35:35 GMT"/>
							<outline text="}" created="Tue, 09 Nov 2021 20:35:20 GMT"/>
							</outline>
						<outline text="catch (err) {" created="Tue, 09 Nov 2021 20:35:21 GMT">
							<outline text="callback (err);" created="Tue, 09 Nov 2021 20:35:52 GMT"/>
							<outline text="return;" created="Tue, 09 Nov 2021 20:35:56 GMT"/>
							<outline text="}" created="Tue, 09 Nov 2021 20:35:24 GMT"/>
							</outline>
						<outline text="options.data = data;" created="Tue, 09 Nov 2021 20:35:16 GMT"/>
						<outline text="if (options.userAgent === undefined) {" created="Tue, 09 Nov 2021 20:38:29 GMT">
							<outline text="options.userAgent = config.userAgent;" created="Tue, 09 Nov 2021 20:38:50 GMT"/>
							<outline text="}" created="Tue, 09 Nov 2021 20:38:46 GMT"/>
							</outline>
						<outline text="if (options.type === undefined) {" created="Tue, 09 Nov 2021 20:38:29 GMT">
							<outline text="options.type = utils.httpExt2MIME (options.path);" created="Tue, 09 Nov 2021 20:38:50 GMT"/>
							<outline text="}" created="Tue, 09 Nov 2021 20:38:46 GMT"/>
							</outline>
						<outline text="if (options.message === undefined) {" created="Tue, 09 Nov 2021 20:38:29 GMT">
							<outline text="options.message = utils.getRandomSnarkySlogan ();" created="Tue, 09 Nov 2021 20:38:50 GMT"/>
							<outline text="}" created="Tue, 09 Nov 2021 20:38:46 GMT"/>
							</outline>
						<outline text="" created="Tue, 09 Nov 2021 20:35:16 GMT"/>
						<outline text="var bodyStruct = { ">
							<outline text="message: options.message,"/>
							<outline text="committer: options.committer,"/>
							<outline text="content: Buffer.from (options.data).toString (&quot;base64&quot;)"/>
							<outline text="};"/>
							</outline>
						<outline text="downloadFromGithub (options.username, options.repository, options.path, options.accessToken, function (err, jstruct) {" created="Tue, 09 Nov 2021 20:24:45 GMT">
							<outline text="if (jstruct !== undefined) {">
								<outline text="bodyStruct.sha = jstruct.sha;"/>
								<outline text="}"/>
								</outline>
							<outline text="var url = &quot;https://api.github.com/repos/&quot; + options.username + &quot;/&quot; + options.repository + &quot;/contents/&quot; + options.path;"/>
							<outline text="var theRequest = {">
								<outline text="method: &quot;PUT&quot;,"/>
								<outline text="url,"/>
								<outline text="body: JSON.stringify (bodyStruct),"/>
								<outline text="auth: {" isComment="true">
									<outline text="user: options.username,"/>
									<outline text="pass: options.password,"/>
									<outline text="sendImmediately: true"/>
									<outline text="},"/>
									</outline>
								<outline text="headers: {">
									<outline text="&quot;User-Agent&quot;: options.userAgent,"/>
									<outline text="&quot;Authorization&quot;: &quot;token &quot; + options.accessToken,"/>
									<outline text="&quot;Content-Type&quot;: options.type"/>
									<outline text="}"/>
									</outline>
								<outline text="};"/>
								</outline>
							<outline text="request (theRequest, function (err, response, body) { ">
								<outline text="if (err) {">
									<outline text="callback (err);"/>
									<outline text="}"/>
									</outline>
								<outline text="else {">
									<outline text="var rateLimitMessage;" created="Tue, 09 Nov 2021 20:51:46 GMT"/>
									<outline text="if (response.headers [&quot;x-ratelimit-remaining&quot;] == 0) {">
										<outline text="var theLimit = response.headers [&quot;x-ratelimit-limit&quot;];"/>
										<outline text="rateLimitMessage = &quot;GitHub reported a rate limit error. You are limited to &quot; + theLimit + &quot; calls per hour.&quot;;"/>
										<outline text="}"/>
										</outline>
									<outline text="var returnedStruct = JSON.parse (body);" created="Tue, 09 Nov 2021 21:05:25 GMT"/>
									<outline text="returnedStruct.statusCode = response.statusCode;" created="Tue, 09 Nov 2021 21:05:25 GMT"/>
									<outline text="returnedStruct.rateLimitMessage = rateLimitMessage;" created="Tue, 09 Nov 2021 21:05:25 GMT"/>
									<outline text="callback (undefined, returnedStruct);" created="Tue, 09 Nov 2021 20:50:17 GMT"/>
									<outline text="}"/>
									</outline>
								<outline text="});"/>
								</outline>
							<outline text="});" created="Tue, 09 Nov 2021 20:25:41 GMT"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="function getGithubDirectory (username, repository, path, accessToken, callback) {">
						<outline text="Changes" isComment="true" created="Tue, 04 May 2021 15:18:57 GMT">
							<outline text="5/4/21; 11:19:00 AM by DW" created="Tue, 04 May 2021 15:18:59 GMT">
								<outline text="Added to package from repocontents test app." created="Tue, 04 May 2021 15:19:01 GMT"/>
								</outline>
							</outline>
						<outline text="function loadDirectory (theArray, parentpath, callback) {">
							<outline text="function nextFile (ix) {">
								<outline text="if (ix &lt; theArray.length) {">
									<outline text="var item = theArray [ix];"/>
									<outline text="if (item.type == &quot;dir&quot;) {">
										<outline text="getGithubDirectory (username, repository, item.path, accessToken, function (err, jstruct) {">
											<outline text="if (jstruct !== undefined) { //no error">
												<outline text="item.subs = jstruct;"/>
												<outline text="}"/>
												</outline>
											<outline text="nextFile (ix + 1);"/>
											<outline text="});"/>
											</outline>
										<outline text="}"/>
										</outline>
									<outline text="else {">
										<outline text="nextFile (ix + 1);"/>
										<outline text="}"/>
										</outline>
									<outline text="}"/>
									</outline>
								<outline text="else {">
									<outline text="callback ();"/>
									<outline text="}"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text="nextFile (0);"/>
							<outline text="}"/>
							</outline>
						<outline text="if (utils.beginsWith (path, &quot;/&quot;)) {">
							<outline text="path = utils.stringDelete (path, 1, 1);"/>
							<outline text="}"/>
							</outline>
						<outline text="var theRequest = {">
							<outline text="method: &quot;GET&quot;,"/>
							<outline text="url: &quot;https://api.github.com/repos/&quot; + username + &quot;/&quot; + repository + &quot;/contents/&quot; + path,"/>
							<outline text="headers: {">
								<outline text="&quot;User-Agent&quot;: config.userAgent,"/>
								<outline text="&quot;Authorization&quot;: &quot;token &quot; + accessToken,"/>
								<outline text="}"/>
								</outline>
							<outline text="};"/>
							</outline>
						<outline text="request (theRequest, function (err, response, body) { ">
							<outline text="if (err) {">
								<outline text="callback (err);"/>
								<outline text="}"/>
								</outline>
							<outline text="else {">
								<outline text="try {">
									<outline text="var jstruct = JSON.parse (body);"/>
									<outline text="if (Array.isArray (jstruct)) { //it's a directory">
										<outline text="loadDirectory (jstruct, path, function () {">
											<outline text="callback (undefined, jstruct);"/>
											<outline text="});"/>
											</outline>
										<outline text="}"/>
										</outline>
									<outline text="else {">
										<outline text="callback (undefined, jstruct);"/>
										<outline text="}"/>
										</outline>
									<outline text="}"/>
									</outline>
								<outline text="catch (err) {">
									<outline text="if (callback !== undefined) {">
										<outline text="callback (err);"/>
										<outline text="}"/>
										</outline>
									<outline text="}"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text="});"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="function getGithubUserInfo (username, accessToken, callback) {">
						<outline text="var url = &quot;https://api.github.com/user&quot;;" created="Tue, 09 Nov 2021 18:16:50 GMT"/>
						<outline text="if (username !== undefined) {" created="Tue, 09 Nov 2021 18:16:21 GMT">
							<outline text="url += &quot;s/&quot; + username" created="Tue, 09 Nov 2021 18:16:37 GMT"/>
							<outline text="}" created="Tue, 09 Nov 2021 18:16:26 GMT"/>
							</outline>
						<outline text="var theRequest = {">
							<outline text="method: &quot;GET&quot;,"/>
							<outline text="url,"/>
							<outline text="headers: {">
								<outline text="&quot;User-Agent&quot;: config.userAgent,"/>
								<outline text="&quot;Authorization&quot;: &quot;token &quot; + accessToken"/>
								<outline text="}"/>
								</outline>
							<outline text="};"/>
							</outline>
						<outline text="request (theRequest, function (err, response, body) { ">
							<outline text="if (err) {" created="Wed, 10 Nov 2021 17:00:36 GMT">
								<outline text="callback (err);" created="Wed, 10 Nov 2021 17:00:40 GMT"/>
								<outline text="}" created="Wed, 10 Nov 2021 17:00:44 GMT"/>
								</outline>
							<outline text="else {" created="Wed, 10 Nov 2021 17:00:45 GMT">
								<outline text="try {">
									<outline text="var jstruct = JSON.parse (body);"/>
									<outline text="callback (undefined, jstruct);" created="Wed, 10 Nov 2021 17:01:11 GMT"/>
									<outline text="}"/>
									</outline>
								<outline text="catch (err) {">
									<outline text="callback (err);" created="Wed, 10 Nov 2021 17:00:40 GMT"/>
									<outline text="}"/>
									</outline>
								<outline text="}" created="Wed, 10 Nov 2021 17:00:47 GMT"/>
								</outline>
							<outline text="});"/>
							</outline>
						<outline text="}"/>
						</outline>
					</outline>
				<outline text=""/>
				<outline text="function startup (options, callback) {">
					<outline text="Changes" isComment="true">
						<outline text="1/22/21; 11:19:04 AM by DW">
							<outline text="At start, copy scalars from options to config."/>
							</outline>
						</outline>
					<outline text="function readConfig (f, theConfig, flReportError, callback) { ">
						<outline text="Changes" isComment="true">
							<outline text="1/21/21; 12:35:00 PM by DW">
								<outline text="New param, flReportError."/>
								</outline>
							</outline>
						<outline text="fs.readFile (f, function (err, jsontext) {">
							<outline text="if (err) {">
								<outline text="if (flReportError) { //1/21/21 by DW">
									<outline text="console.log (&quot;readConfig: err.message == &quot; + err.message);"/>
									<outline text="}"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text="else {">
								<outline text="try {">
									<outline text="var jstruct = JSON.parse (jsontext);"/>
									<outline text="console.log (&quot;readConfig: f == &quot; + f + &quot;, jstruct == &quot; + utils.jsonStringify (jstruct));" isComment="true"/>
									<outline text="for (var x in jstruct) {">
										<outline text="theConfig [x] = jstruct [x];"/>
										<outline text="}"/>
										</outline>
									<outline text="}"/>
									</outline>
								<outline text="catch (err) {">
									<outline text="console.log (&quot;readConfig: err.message == &quot; + err.message);"/>
									<outline text="}"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text="callback ();"/>
							<outline text="});"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="function startDavetwitter (httpRequestCallback) { //patch over a design problem in starting up davetwitter and davehttp -- 7/20/20 by DW ">
						<outline text="Changes" isComment="true">
							<outline text="1/27/21; 10:53:07 AM by DW">
								<outline text="Customized and streamlined for daveappserver."/>
								</outline>
							<outline text="7/20/20; 11:45:50 AM by DW">
								<outline text="Created. I made a mistake designing the interface to davetwitter. "/>
								<outline text="We're only passing config.twitter to davetwitter, so we make sure it has all the right elements to configure davehttp as well."/>
								<outline text="It's a mess. We should be able to set up davehttp here, it shouldn't be started in davetwitter. "/>
								<outline text="This can be dropped into any davetwitter-using app. possibly should be included in davetwitter itself at some point. "/>
								<outline text="Whew."/>
								</outline>
							</outline>
						<outline text="if (config.twitter === undefined) {">
							<outline text="config.twitter = new Object ();"/>
							<outline text="}"/>
							</outline>
						<outline text="config.twitter.myPort = config.port;"/>
						<outline text="config.twitter.httpPort = config.port;"/>
						<outline text="config.twitter.myDomain = config.myDomain;"/>
						<outline text="config.twitter.flLogToConsole = config.flLogToConsole;"/>
						<outline text="config.twitter.flAllowAccessFromAnywhere = config.flAllowAccessFromAnywhere;"/>
						<outline text="config.twitter.flPostEnabled = config.flPostEnabled;"/>
						<outline text="config.twitter.blockedAddresses = config.blockedAddresses;"/>
						<outline text="config.twitter.httpRequestCallback = httpRequestCallback;"/>
						<outline text="config.twitter.http404Callback = http404Callback; //1/24/21 by DW"/>
						<outline text="config.twitter.twitterConsumerKey = config.twitterConsumerKey;"/>
						<outline text="config.twitter.twitterConsumerSecret = config.twitterConsumerSecret;"/>
						<outline text="davetwitter.start (config.twitter);"/>
						<outline text="}"/>
						</outline>
					<outline text="function handleHttpRequest (theRequest) {">
						<outline text="Changes" isComment="true">
							<outline text="7/18/20; 10:55:45 AM by DW">
								<outline text="This is a callback for davetwitter. We get the first shot at any request. Return true if we consumed it, false otherwise."/>
								</outline>
							</outline>
						<outline text="const params = theRequest.params;"/>
						<outline text="const token = params.oauth_token;"/>
						<outline text="const secret = params.oauth_token_secret;"/>
						<outline text="const flprivate = (params.flprivate === undefined) ? false : utils.getBoolean (params.flprivate);"/>
						<outline text=""/>
						<outline text="stats.ctHits++;"/>
						<outline text="stats.ctHitsToday++;"/>
						<outline text="stats.ctHitsThisRun++;"/>
						<outline text="stats.whenLastHit = new Date ();"/>
						<outline text="statsChanged ();"/>
						<outline text=""/>
						<outline text="function returnPlainText (s) {">
							<outline text="theRequest.httpReturn (200, &quot;text/plain&quot;, s.toString ());"/>
							<outline text="}"/>
							</outline>
						<outline text="function returnData (jstruct) {">
							<outline text="if (jstruct === undefined) {">
								<outline text="jstruct = {};"/>
								<outline text="}"/>
								</outline>
							<outline text="theRequest.httpReturn (200, &quot;application/json&quot;, utils.jsonStringify (jstruct));"/>
							<outline text="}"/>
							</outline>
						<outline text="function returnHtml (htmltext) {">
							<outline text="theRequest.httpReturn (200, &quot;text/html&quot;, htmltext);"/>
							<outline text="}"/>
							</outline>
						<outline text="function returnXml (xmltext) {">
							<outline text="theRequest.httpReturn (200, &quot;text/xml&quot;, xmltext);"/>
							<outline text="}"/>
							</outline>
						<outline text="function returnNotFound () {">
							<outline text="theRequest.httpReturn (404, &quot;text/plain&quot;, &quot;Not found.&quot;);"/>
							<outline text="}"/>
							</outline>
						<outline text="function returnError (jstruct) {">
							<outline text="theRequest.httpReturn (500, &quot;application/json&quot;, utils.jsonStringify (jstruct));"/>
							<outline text="}"/>
							</outline>
						<outline text="function httpReturn (err, jstruct) {">
							<outline text="if (err) {">
								<outline text="returnError (err);"/>
								<outline text="}"/>
								</outline>
							<outline text="else {">
								<outline text="returnData (jstruct);"/>
								<outline text="}"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="function httpReturnRedirect (url, code) { //9/30/20 by DW">
							<outline text="var headers = {">
								<outline text="location: url"/>
								<outline text="};"/>
								</outline>
							<outline text="if (code === undefined) {">
								<outline text="code = 302;"/>
								<outline text="}"/>
								</outline>
							<outline text="theRequest.httpReturn (code, &quot;text/plain&quot;, code + &quot; REDIRECT&quot;, headers);"/>
							<outline text="}"/>
							<outline text=""/>
							</outline>
						<outline text="function httpReturnObject (err, jstruct) {">
							<outline text="if (err) {">
								<outline text="returnError (err);"/>
								<outline text="}"/>
								</outline>
							<outline text="else {">
								<outline text="returnData (jstruct);"/>
								<outline text="}"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="function httpReturnZipFile (f) { //4/13/20 by DW">
							<outline text="fs.readFile (f, function (err, data) {">
								<outline text="if (err) {">
									<outline text="returnError (err);"/>
									<outline text="}"/>
									</outline>
								<outline text="else {">
									<outline text="theRequest.httpReturn (200, &quot;application/zip&quot;, data);"/>
									<outline text="}"/>
									</outline>
								<outline text="});"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="function returnServerHomePage () {">
							<outline text="Changes" isComment="true" created="Tue, 09 Mar 2021 16:44:49 GMT">
								<outline text="2/4/22; 3:57:54 PM by DW" created="Fri, 04 Feb 2022 20:57:53 GMT">
									<outline text="A new config value config.pathServerHomePageSource allows the home page text to be loaded from a local file." created="Fri, 04 Feb 2022 20:57:58 GMT"/>
									</outline>
								<outline text="3/9/21; 11:44:51 AM by DW" created="Tue, 09 Mar 2021 16:44:50 GMT">
									<outline text="The threadviewer app wants to handle URLs like this" created="Tue, 09 Mar 2021 16:44:52 GMT">
										<outline text="http://threadviewer/1369210173953372166" created="Tue, 09 Mar 2021 16:45:06 GMT"/>
										</outline>
									<outline text="The value of the id has to be transmitted to the JS code in the home page." created="Tue, 09 Mar 2021 16:45:25 GMT"/>
									<outline text="So the upper level changes the path to &quot;/&quot; and puts the id in theRequest.addToPagetable, and we handle it here. " created="Tue, 09 Mar 2021 16:45:48 GMT"/>
									</outline>
								</outline>
							<outline text="function servePage (templatetext) {" created="Fri, 04 Feb 2022 20:59:16 GMT">
								<outline text="var pagetable = {">
									<outline text="productName: config.productName, "/>
									<outline text="productNameForDisplay: config.productNameForDisplay, "/>
									<outline text="version: config.version,"/>
									<outline text="urlServerForClient: config.urlServerForClient,"/>
									<outline text="urlWebsocketServerForClient: config.urlWebsocketServerForClient,"/>
									<outline text="flEnableLogin: config.flEnableLogin,"/>
									<outline text="prefsPath: config.prefsPath,"/>
									<outline text="docsPath: config.docsPath,"/>
									<outline text="idGitHubClient: config.githubClientId //11/9/21 by DW" created="Tue, 09 Nov 2021 16:06:48 GMT"/>
									<outline text="};"/>
									</outline>
								<outline text="if (theRequest.addToPagetable !== undefined) { //3/9/21 by DW" created="Tue, 09 Mar 2021 16:43:48 GMT">
									<outline text="for (var x in theRequest.addToPagetable) {" created="Tue, 09 Mar 2021 16:44:10 GMT">
										<outline text="pagetable [x] = theRequest.addToPagetable [x];" created="Tue, 09 Mar 2021 16:44:19 GMT"/>
										<outline text="}" created="Tue, 09 Mar 2021 16:44:14 GMT"/>
										</outline>
									<outline text="}" created="Tue, 09 Mar 2021 16:44:04 GMT"/>
									</outline>
								<outline text="if (config.addMacroToPagetable !== undefined) {">
									<outline text="config.addMacroToPagetable (pagetable);"/>
									<outline text="}"/>
									</outline>
								<outline text="var pagetext = utils.multipleReplaceAll (templatetext.toString (), pagetable, false, &quot;[%&quot;, &quot;%]&quot;);"/>
								<outline text="returnHtml (pagetext);"/>
								<outline text="}" created="Fri, 04 Feb 2022 21:02:43 GMT"/>
								</outline>
							<outline text="if (config.pathServerHomePageSource !== undefined) {" created="Fri, 04 Feb 2022 20:59:18 GMT">
								<outline text="fs.readFile (config.pathServerHomePageSource, function (err, templatetext) {" created="Fri, 04 Feb 2022 20:59:33 GMT">
									<outline text="if (err) {" created="Fri, 04 Feb 2022 21:00:01 GMT">
										<outline text="console.log (&quot;returnServerHomePage: err.message == &quot; + err.message + &quot;, f == &quot; + config.pathServerHomePageSource);" created="Fri, 04 Feb 2022 21:00:12 GMT"/>
										<outline text="}" created="Fri, 04 Feb 2022 21:00:05 GMT"/>
										</outline>
									<outline text="else {" created="Fri, 04 Feb 2022 21:00:06 GMT">
										<outline text="servePage (templatetext);" created="Fri, 04 Feb 2022 21:01:42 GMT"/>
										<outline text="}" created="Fri, 04 Feb 2022 21:00:07 GMT"/>
										</outline>
									<outline text="});" created="Fri, 04 Feb 2022 20:59:53 GMT"/>
									</outline>
								<outline text="}" created="Fri, 04 Feb 2022 20:59:29 GMT"/>
								</outline>
							<outline text="else {" created="Fri, 04 Feb 2022 21:02:00 GMT">
								<outline text="request (config.urlServerHomePageSource, function (err, response, templatetext) {">
									<outline text="if (!err &amp;&amp; response.statusCode == 200) {">
										<outline text="servePage (templatetext);" created="Fri, 04 Feb 2022 21:01:42 GMT"/>
										<outline text="}"/>
										</outline>
									<outline text="});"/>
									</outline>
								<outline text="}" created="Fri, 04 Feb 2022 21:02:02 GMT"/>
								</outline>
							<outline text="" isComment="true" created="Fri, 04 Feb 2022 20:59:18 GMT"/>
							<outline text="request (config.urlServerHomePageSource, function (error, response, templatetext) {" isComment="true">
								<outline text="if (!error &amp;&amp; response.statusCode == 200) {">
									<outline text="var pagetable = {">
										<outline text="productName: config.productName, "/>
										<outline text="productNameForDisplay: config.productNameForDisplay, "/>
										<outline text="version: config.version,"/>
										<outline text="urlServerForClient: config.urlServerForClient,"/>
										<outline text="urlWebsocketServerForClient: config.urlWebsocketServerForClient,"/>
										<outline text="flEnableLogin: config.flEnableLogin,"/>
										<outline text="prefsPath: config.prefsPath,"/>
										<outline text="docsPath: config.docsPath,"/>
										<outline text="idGitHubClient: config.githubClientId //11/9/21 by DW" created="Tue, 09 Nov 2021 16:06:48 GMT"/>
										<outline text="};"/>
										</outline>
									<outline text="if (theRequest.addToPagetable !== undefined) { //3/9/21 by DW" created="Tue, 09 Mar 2021 16:43:48 GMT">
										<outline text="for (var x in theRequest.addToPagetable) {" created="Tue, 09 Mar 2021 16:44:10 GMT">
											<outline text="pagetable [x] = theRequest.addToPagetable [x];" created="Tue, 09 Mar 2021 16:44:19 GMT"/>
											<outline text="}" created="Tue, 09 Mar 2021 16:44:14 GMT"/>
											</outline>
										<outline text="}" created="Tue, 09 Mar 2021 16:44:04 GMT"/>
										</outline>
									<outline text="if (config.addMacroToPagetable !== undefined) {">
										<outline text="config.addMacroToPagetable (pagetable);"/>
										<outline text="}"/>
										</outline>
									<outline text="var pagetext = utils.multipleReplaceAll (templatetext, pagetable, false, &quot;[%&quot;, &quot;%]&quot;);"/>
									<outline text="returnHtml (pagetext);"/>
									<outline text="}"/>
									</outline>
								<outline text="});"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="function callWithScreenname (callback) {">
							<outline text="davetwitter.getScreenName (token, secret, function (screenname) {" created="Wed, 09 Jul 2014 23:57:16 GMT" pgfnum="42784">
								<outline text="if (screenname === undefined) {" created="Thu, 10 Jul 2014 00:53:00 GMT" pgfnum="42793">
									<outline text="returnError ({message: &quot;Can't do the thing you want because the accessToken is not valid.&quot;});    "/>
									<outline text="}" created="Thu, 10 Jul 2014 00:53:11 GMT" pgfnum="42797"/>
									</outline>
								<outline text="else {" created="Thu, 10 Jul 2014 00:53:12 GMT" pgfnum="42798">
									<outline text="callback (screenname);"/>
									<outline text="}" created="Thu, 10 Jul 2014 00:53:14 GMT" pgfnum="42799"/>
									</outline>
								<outline text="});" created="Wed, 09 Jul 2014 23:57:25 GMT" pgfnum="42785"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="function handleGithubOauthCallback (theCode) { //11/8/21 by DW" isComment="true">
							<outline text="Changes" isComment="true" created="Mon, 08 Nov 2021 17:18:01 GMT">
								<outline text="11/8/21; 12:18:03 PM by DW" created="Mon, 08 Nov 2021 17:18:02 GMT">
									<outline text="Cribbed from githubpub." created="Mon, 08 Nov 2021 17:18:03 GMT"/>
									</outline>
								</outline>
							<outline text="var params = {">
								<outline text="client_id: config.githubClientId,"/>
								<outline text="client_secret: config.githubClientSecret,"/>
								<outline text="code: theCode"/>
								<outline text="};"/>
								</outline>
							<outline text="var apiUrl = &quot;https://github.com/login/oauth/access_token?&quot; + utils.buildParamList (params);"/>
							<outline text="var githubRequest = {">
								<outline text="method: &quot;POST&quot;,"/>
								<outline text="url: apiUrl"/>
								<outline text="followRedirect: true, " isComment="true"/>
								<outline text="headers: {Accept: &quot;application/json&quot;}" isComment="true"/>
								<outline text="};"/>
								</outline>
							<outline text="console.log (&quot;handleGithubOauthCallback: githubRequest === &quot; + utils.jsonStringify (githubRequest));"/>
							<outline text="request (githubRequest, function (err, response, body) {">
								<outline text="if (err) {">
									<outline text="console.log (&quot;handleGithubOauthCallback: err.message == &quot; + err.message);"/>
									<outline text="returnError (err);" created="Mon, 08 Nov 2021 17:33:37 GMT"/>
									<outline text="}"/>
									</outline>
								<outline text="else {">
									<outline text="var postbody = qs.parse (body);"/>
									<outline text="var urlRedirect = &quot;/?githubaccesstoken=&quot; + postbody.access_token;"/>
									<outline text="console.log (&quot;handleGithubOauthCallback: urlRedirect = &quot; + urlRedirect);"/>
									<outline text="httpReturnRedirect (urlRedirect);" created="Mon, 08 Nov 2021 17:38:59 GMT"/>
									<outline text="}"/>
									</outline>
								<outline text="});"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text=""/>
						<outline text="if (config.httpRequest !== undefined) {">
							<outline text="theRequest.httpReturnObject = httpReturnObject;" isComment="true"/>
							<outline text="theRequest.returnData = returnData;" isComment="true"/>
							<outline text="theRequest.returnPlainText = returnPlainText;" isComment="true"/>
							<outline text="if (config.httpRequest (theRequest)) { //consumed by callback">
								<outline text="return (true);"/>
								<outline text="}"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="switch (theRequest.lowermethod) {">
							<outline text="case &quot;post&quot;:">
								<outline text="switch (theRequest.lowerpath) {">
									<outline text="case &quot;/publishfile&quot;: //1/22/21 by DW" created="Thu, 26 Jun 2014 11:33:59 GMT" pgfnum="42464">
										<outline text="callWithScreenname (function (screenname) {">
											<outline text="var decodedText = decodeBase64Post (theRequest.postBody); //9/8/21 by DW" isComment="true" created="Wed, 08 Sep 2021 19:42:27 GMT"/>
											<outline text="publishFile (screenname, params.relpath, params.type, flprivate, theRequest.postBody.toString (), function (err, data) {">
												<outline text="if (err) {">
													<outline text="returnError (err);"/>
													<outline text="}"/>
													</outline>
												<outline text="else { //quirk in API, it wants a string, not a JSON struct">
													<outline text="if (!flprivate) {" created="Sat, 04 Dec 2021 19:04:13 GMT">
														<outline text="if (config.publicFileSaved !== undefined) {">
															<outline text="config.publicFileSaved (token, secret, getPublicFileUrl (screenname, params.relpath));"/>
															<outline text="}"/>
															</outline>
														<outline text="}" created="Sat, 04 Dec 2021 19:04:36 GMT"/>
														</outline>
													<outline text="returnPlainText (utils.jsonStringify (data));"/>
													<outline text="}"/>
													</outline>
												<outline text="});"/>
												</outline>
											<outline text="});"/>
											</outline>
										<outline text="return (true);"/>
										</outline>
									<outline text="case &quot;/writewholefile&quot;: //2/25/21 by DW -- special way to write a file, for scripting" created="Thu, 25 Feb 2021 17:42:29 GMT">
										<outline text="callWithScreenname (function (screenname) {">
											<outline text="writeWholeFile (screenname, params.relpath, theRequest.postBody.toString (), httpReturn);"/>
											<outline text="});"/>
											</outline>
										<outline text="return (true);" created="Thu, 25 Feb 2021 17:42:43 GMT"/>
										</outline>
									<outline text="case &quot;/uploadtogithub&quot;:  //11/9/21 by DW">
										<outline text="uploadToGithub (params.options, theRequest.postBody, httpReturn);"/>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="}"/>
									</outline>
								<outline text="break;"/>
								</outline>
							<outline text="case &quot;get&quot;:">
								<outline text="switch (theRequest.lowerpath) {">
									<outline text="case &quot;/&quot;:">
										<outline text="returnServerHomePage ();"/>
										<outline text="return (true);"/>
										</outline>
									<outline text="case &quot;/now&quot;:">
										<outline text="returnPlainText (new Date ());"/>
										<outline text="return (true);"/>
										</outline>
									<outline text="case &quot;/version&quot;:">
										<outline text="returnData ({">
											<outline text="productName: config.productName,"/>
											<outline text="version: config.version"/>
											<outline text="});"/>
											</outline>
										<outline text="return (true);"/>
										</outline>
									<outline text="case &quot;/stats&quot;:">
										<outline text="returnData (stats);"/>
										<outline text="return (true);"/>
										</outline>
									<outline text="case &quot;/getfile&quot;:">
										<outline text="callWithScreenname (function (screenname) {">
											<outline text="getFile (screenname, params.relpath, flprivate, httpReturn);"/>
											<outline text="});"/>
											</outline>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="case &quot;/getoptionalfile&quot;: ">
										<outline text="callWithScreenname (function (screenname) {">
											<outline text="getFile (screenname, params.relpath, flprivate, function (err, data) {">
												<outline text="if (err) {">
													<outline text="returnData ({}); //return nothing"/>
													<outline text="}"/>
													</outline>
												<outline text="else {">
													<outline text="returnData ({data});"/>
													<outline text="}"/>
													</outline>
												<outline text="});"/>
												</outline>
											<outline text="});"/>
											</outline>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="case &quot;/getoptionalpublicorprivatefile&quot;: //4/4/21 by DW" isComment="true" created="Sun, 04 Apr 2021 17:17:35 GMT">
										<outline text="callWithScreenname (function (screenname) {">
											<outline text="getOptionalPublicOrPrivateFile (screenname, params.relpath, function (err, data) {">
												<outline text="if (err) {">
													<outline text="returnData ({}); //return nothing"/>
													<outline text="}"/>
													</outline>
												<outline text="else {">
													<outline text="returnData ({data});"/>
													<outline text="}"/>
													</outline>
												<outline text="});"/>
												</outline>
											<outline text="});"/>
											</outline>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="case &quot;/getfilelist&quot;: ">
										<outline text="callWithScreenname (function (screenname) {">
											<outline text="getFileList (screenname, flprivate, httpReturn);"/>
											<outline text="});"/>
											</outline>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										<outline text="" isComment="true"/>
										<outline text="" isComment="true"/>
										<outline text="" isComment="true"/>
										<outline text="var accessToken = parsedUrl.query.oauth_token;" isComment="true" created="Mon, 21 Apr 2014 23:15:16 GMT" pgfnum="40413"/>
										<outline text="var accessTokenSecret = parsedUrl.query.oauth_token_secret;" isComment="true" created="Mon, 21 Apr 2014 23:15:16 GMT" pgfnum="40413"/>
										<outline text="var flprivate = utils.getBoolean (parsedUrl.query.flprivate);" isComment="true" created="Mon, 04 Aug 2014 00:07:18 GMT" pgfnum="43127"/>
										<outline text="getScreenName (accessToken, accessTokenSecret, function (screenName) {" isComment="true" created="Wed, 09 Jul 2014 23:57:16 GMT" pgfnum="42784">
											<outline text="if (screenName === undefined) {" created="Thu, 10 Jul 2014 00:53:00 GMT" pgfnum="42793">
												<outline text="errorResponse ({message: &quot;Can't get the file list because the accessToken is not valid.&quot;});    "/>
												<outline text="}" created="Thu, 10 Jul 2014 00:53:11 GMT" pgfnum="42797"/>
												</outline>
											<outline text="else {" created="Thu, 10 Jul 2014 00:53:12 GMT" pgfnum="42798">
												<outline text="var s3path = getS3UsersPath (flprivate) + screenName + &quot;/&quot;;" created="Thu, 15 May 2014 15:40:17 GMT" pgfnum="41633"/>
												<outline text="console.log (&quot;/getfilelist: s3 path == &quot; + s3path); " isComment="true" created="Tue, 22 Jul 2014 13:24:40 GMT" pgfnum="43027"/>
												<outline text="getUserFileList (s3path, function (error, theList) {">
													<outline text="if (error) {">
														<outline text="errorResponse (error);    "/>
														<outline text="}"/>
														</outline>
													<outline text="else { ">
														<outline text="var returnedList = new Array (); //return a processed array -- 3/5/15 by DW"/>
														<outline text="for (var i = 0; i &lt; theList.length; i++) {">
															<outline text="var obj = new Object (), s3obj = theList [i];"/>
															<outline text="//set obj.path -- start copying into the object path when we pass the user's screen name">
																<outline text="var splitlist = s3obj.Key.split (&quot;/&quot;), flcopy = false, objectpath = &quot;&quot;;"/>
																<outline text="for (var j = 0; j &lt; splitlist.length; j++) {">
																	<outline text="if (flcopy) {">
																		<outline text="if (objectpath.length &gt; 0) {">
																			<outline text="objectpath += &quot;/&quot;;"/>
																			<outline text="}"/>
																			</outline>
																		<outline text="objectpath += splitlist [j];"/>
																		<outline text="}"/>
																		</outline>
																	<outline text="else {">
																		<outline text="if (splitlist [j] == screenName) {">
																			<outline text="flcopy = true;"/>
																			<outline text="}"/>
																			</outline>
																		<outline text="}"/>
																		</outline>
																	<outline text="}"/>
																	</outline>
																<outline text="obj.path = objectpath;"/>
																</outline>
															<outline text="obj.whenLastChange = s3obj.LastModified;"/>
															<outline text="obj.whenCreated = s3obj.whenCreated; //only present for filesystem objects --3/2/20 by DW"/>
															<outline text="obj.ctChars = s3obj.Size;"/>
															<outline text="returnedList [i] = obj;"/>
															<outline text="}"/>
															</outline>
														<outline text="dataResponse (returnedList);"/>
														<outline text="}"/>
														</outline>
													<outline text="});"/>
													</outline>
												<outline text="}" created="Thu, 10 Jul 2014 00:53:14 GMT" pgfnum="42799"/>
												</outline>
											<outline text="});" created="Wed, 09 Jul 2014 23:57:25 GMT" pgfnum="42785"/>
											</outline>
										<outline text="break; " isComment="true"/>
										</outline>
									<outline text="case &quot;/makefilepublic&quot;: //2/20/21 by DW">
										<outline text="callWithScreenname (function (screenname) {">
											<outline text="makeFilePublic (screenname, params.relpath, httpReturn);"/>
											<outline text="});"/>
											</outline>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="case &quot;/getfilehierarchy&quot;: //2/21/21 by DW">
										<outline text="callWithScreenname (function (screenname) {">
											<outline text="getFileHierarchy (screenname, httpReturn);"/>
											<outline text="});"/>
											</outline>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="case &quot;/deletefile&quot;: //2/23/21 by DW">
										<outline text="callWithScreenname (function (screenname) {">
											<outline text="deleteFile (screenname, params.relpath, httpReturn);"/>
											<outline text="});"/>
											</outline>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="case &quot;/readwholefile&quot;: //2/24/21 by DW">
										<outline text="callWithScreenname (function (screenname) {">
											<outline text="readWholeFile (screenname, params.relpath, httpReturn);"/>
											<outline text="});"/>
											</outline>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="case &quot;/fileexists&quot;: //5/29/21 by DW">
										<outline text="callWithScreenname (function (screenname) {">
											<outline text="fileExists (screenname, params.relpath, httpReturn);"/>
											<outline text="});"/>
											</outline>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="case &quot;/httpreadurl&quot;: //2/26/21 by DW" created="Fri, 26 Feb 2021 19:35:45 GMT">
										<outline text="callWithScreenname (function (screenname) {">
											<outline text="httpReadUrl (params.url, httpReturn);"/>
											<outline text="});"/>
											</outline>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="case &quot;/httprequest&quot;: //11/5/21 by DW" created="Fri, 26 Feb 2021 19:35:45 GMT">
										<outline text="callWithScreenname (function (screenname) {">
											<outline text="httpFullRequest (params.request, httpReturn);"/>
											<outline text="});"/>
											</outline>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="case &quot;/getdomainname&quot;: //2/27/21 by DW" created="Sat, 27 Feb 2021 16:51:06 GMT">
										<outline text="callWithScreenname (function (screenname) {">
											<outline text="getDomainNameVerb (params.dottedid, httpReturn);"/>
											<outline text="});"/>
											</outline>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="case &quot;/getdottedid&quot;: //2/27/21 by DW" created="Sat, 27 Feb 2021 16:51:06 GMT">
										<outline text="callWithScreenname (function (screenname) {">
											<outline text="getDottedIdVerb (params.name, httpReturn);"/>
											<outline text="});"/>
											</outline>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="case &quot;/myfiles&quot;: //3/7/21 by DW">
										<outline text="callWithScreenname (function (screenname) {">
											<outline text="getUserData (screenname, function (err, zipfile) {">
												<outline text="if (err) {">
													<outline text="errorResponse (err);"/>
													<outline text="}"/>
													</outline>
												<outline text="else {">
													<outline text="httpReturnZipFile (zipfile);"/>
													<outline text="}"/>
													</outline>
												<outline text="});"/>
												</outline>
											<outline text="});"/>
											</outline>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="case &quot;/getfileinfo&quot;: //4/1/21 by DW">
										<outline text="callWithScreenname (function (screenname) {">
											<outline text="getFileInfo (screenname, params.relpath, httpReturn);"/>
											<outline text="});"/>
											</outline>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="case &quot;/githuboauthcallback&quot;: //11/8/21 by DW">
										<outline text="handleGithubOauthCallback (params.code, function (err, urlRedirect) {">
											<outline text="if (err) {" created="Mon, 08 Nov 2021 21:50:21 GMT">
												<outline text="returnError (err);" created="Mon, 08 Nov 2021 21:50:23 GMT"/>
												<outline text="}" created="Mon, 08 Nov 2021 21:50:27 GMT"/>
												</outline>
											<outline text="else {" created="Mon, 08 Nov 2021 21:50:28 GMT">
												<outline text="httpReturnRedirect (urlRedirect);" created="Mon, 08 Nov 2021 21:50:38 GMT"/>
												<outline text="}" created="Mon, 08 Nov 2021 21:50:30 GMT"/>
												</outline>
											<outline text="});" created="Mon, 08 Nov 2021 21:50:17 GMT"/>
											</outline>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="case &quot;/downloadfromgithub&quot;:  //11/8/21 by DW">
										<outline text="downloadFromGithub (params.username, params.repository, params.path, params.accessToken, httpReturn);"/>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="case &quot;/githubgetdirectory&quot;:  //11/10/21 by DW">
										<outline text="getGithubDirectory (params.username, params.repository, params.path, params.accessToken, httpReturn);"/>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="case &quot;/githubgetuserinfo&quot;:  //11/10/21 by DW">
										<outline text="callWithScreenname (function (screenname) {">
											<outline text="getGithubUserInfo (params.username, params.accessToken, httpReturn);"/>
											<outline text="});"/>
											</outline>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="" created="Wed, 10 Nov 2021 14:12:13 GMT"/>
									<outline text="case &quot;/debug&quot;: " isComment="true">
										<outline text="notifySocketSubscribers (&quot;reload&quot;)"/>
										<outline text="returnPlainText (&quot;hello&quot;);"/>
										<outline text="return (true); " created="Wed, 22 Jan 2014 15:18:30 GMT" pgfnum="36266"/>
										</outline>
									<outline text="}"/>
									</outline>
								<outline text="break;"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="return (false);"/>
						<outline text="}"/>
						</outline>
					<outline text="function http404Callback (theRequest) {">
						<outline text="Changes" isComment="true" created="Tue, 03 Aug 2021 21:17:26 GMT">
							<outline text="9/8/21; 9:42:53 AM by DW" created="Wed, 08 Sep 2021 13:42:53 GMT">
								<outline text="Changed call to getfile to call to local routine getFileContent. " created="Wed, 08 Sep 2021 13:42:54 GMT"/>
								<outline text="getfile is converting the contents of the file to a string, which works fine for HTML and JSON files, but screws up binary files like images." created="Wed, 08 Sep 2021 13:43:24 GMT"/>
								<outline text="At some point we'll need to trace through all the calls to getfile and make them able to deal with the buffer, but for right now I wanted to solve the problem for serving image files from the user's public space. " created="Wed, 08 Sep 2021 13:43:56 GMT"/>
								</outline>
							<outline text="8/3/21; 5:17:29 PM by DW" created="Tue, 03 Aug 2021 21:17:27 GMT">
								<outline text="We were returning the content type of plain text for everything. We can do much better. " created="Tue, 03 Aug 2021 21:17:29 GMT"/>
								<outline text="" created="Tue, 03 Aug 2021 21:18:02 GMT"/>
								</outline>
							</outline>
						<outline text="console.log (&quot;http404Callback: theRequest.path == &quot; + theRequest.path);" isComment="true"/>
						<outline text="if (config.flStorageEnabled) {">
							<outline text="if (checkPathForIllegalChars (theRequest.path)) {">
								<outline text="function return404 () {">
									<outline text="theRequest.httpReturn (404, &quot;text/plain&quot;, &quot;Not found.&quot;);"/>
									<outline text="}"/>
									</outline>
								<outline text="function returnPlainText (s) {">
									<outline text="theRequest.httpReturn (200, &quot;text/plain&quot;, s.toString ());"/>
									<outline text="}"/>
									</outline>
								<outline text="" created="Wed, 08 Sep 2021 13:38:32 GMT"/>
								<outline text="function getFileContent (screenname, relpath, flprivate, callback) { //9/8/21 by DW" created="Wed, 08 Sep 2021 13:38:32 GMT">
									<outline text="var f = getFilePath (screenname, relpath, flprivate);"/>
									<outline text="fs.readFile (f, function (err, filetext) {">
										<outline text="if (err) {">
											<outline text="callback (err);"/>
											<outline text="}"/>
											</outline>
										<outline text="else {">
											<outline text="callback (undefined, filetext);" created="Wed, 08 Sep 2021 13:40:29 GMT"/>
											<outline text="}"/>
											</outline>
										<outline text="});"/>
										</outline>
									<outline text="}" created="Wed, 08 Sep 2021 13:39:11 GMT"/>
									</outline>
								<outline text="" created="Wed, 08 Sep 2021 13:38:33 GMT"/>
								<outline text="var path = utils.stringDelete (theRequest.path, 1, 1); //delete leading slash"/>
								<outline text="var screenname = utils.stringNthField (path, &quot;/&quot;, 1);"/>
								<outline text="var relpath = utils.stringDelete (path, 1, screenname.length + 1);"/>
								<outline text="var flprivate = false;"/>
								<outline text="getFileContent (screenname, relpath, flprivate, function (err, filedata) {">
									<outline text="if (err) {">
										<outline text="return404 ();"/>
										<outline text="}"/>
										</outline>
									<outline text="else {">
										<outline text="const ext = utils.stringLastField (relpath, &quot;.&quot;); //8/3/21 by DW"/>
										<outline text="if (ext == relpath) { //no extension" created="Tue, 03 Aug 2021 21:25:28 GMT">
											<outline text="type = config.defaultContentType;" created="Tue, 03 Aug 2021 21:25:40 GMT"/>
											<outline text="}" created="Tue, 03 Aug 2021 21:25:50 GMT"/>
											</outline>
										<outline text="else {" created="Tue, 03 Aug 2021 21:26:47 GMT">
											<outline text="type = utils.httpExt2MIME (ext, config.defaultContentType);" created="Tue, 03 Aug 2021 21:26:57 GMT"/>
											<outline text="}" created="Tue, 03 Aug 2021 21:26:49 GMT"/>
											</outline>
										<outline text="theRequest.httpReturn (200, type, filedata);"/>
										<outline text="returnPlainText (data.filedata);" isComment="true"/>
										<outline text="}"/>
										</outline>
									<outline text="});"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text="else {">
								<outline text="return404 ();"/>
								<outline text="}"/>
								</outline>
							<outline text="return (true); //tell davetwitter we handled it"/>
							<outline text="}"/>
							</outline>
						<outline text="else {">
							<outline text="return (false); //tell davetwitter we didn't handle it"/>
							<outline text="}"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="function everyMinute () {">
						<outline text="var now = new Date ();"/>
						<outline text="if (config.everyMinute !== undefined) {">
							<outline text="config.everyMinute ();"/>
							<outline text="}"/>
							</outline>
						<outline text="if (now.getMinutes () == 0) {">
							<outline text="console.log (&quot;\n&quot; + now.toLocaleTimeString () + &quot;: &quot; + config.productName + &quot; v&quot; + config.version + &quot; running on port &quot; + config.port + &quot;.\n&quot;);"/>
							<outline text="}"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text="function everySecond () {">
						<outline text="if (flStatsChanged) {">
							<outline text="stats.ctWrites++;"/>
							<outline text="flStatsChanged = false;"/>
							<outline text="fs.writeFile (fnameStats, utils.jsonStringify (stats), function () {">
								<outline text="});"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="if (config.everySecond !== undefined) {">
							<outline text="config.everySecond ();"/>
							<outline text="}"/>
							</outline>
						<outline text="}"/>
						</outline>
					<outline text=""/>
					<outline text="utils.copyScalars (options, config); //1/22/21 by DW"/>
					<outline text="readConfig (fnameConfig, config, true, function () { //anything can be overridden by config.json">
						<outline text="readConfig (fnameStats, stats, false, function () {">
							<outline text="if (process.env.PORT !== undefined) { //8/6/20 by DW">
								<outline text="config.port = process.env.PORT;"/>
								<outline text="}"/>
								</outline>
							<outline text="stats.ctStarts++;"/>
							<outline text="stats.ctHitsThisRun = 0;"/>
							<outline text="stats.whenLastStart = whenStart;"/>
							<outline text="statsChanged ();"/>
							<outline text="console.log (&quot;\n&quot; + config.productName + &quot; v&quot; + config.version + &quot; running on port &quot; + config.port + &quot;.\n&quot;);"/>
							<outline text="console.log (&quot;config == &quot; + utils.jsonStringify (config)); "/>
							<outline text="startDavetwitter (handleHttpRequest);"/>
							<outline text="if (config.myDomain === undefined) {">
								<outline text="console.log (&quot;startup: can't start the server because config.myDomain is not defined.&quot;);"/>
								<outline text="}"/>
								</outline>
							<outline text="else {">
								<outline text="config.urlServerForClient = &quot;http://&quot; + config.myDomain + &quot;/&quot;;"/>
								<outline text="config.urlWebsocketServerForClient = &quot;ws://&quot; + utils.stringNthField (config.myDomain, &quot;:&quot;, 1) + &quot;:&quot; + config.websocketPort + &quot;/&quot;;"/>
								<outline text="webSocketStartup (); "/>
								<outline text="setInterval (everySecond, 1000); "/>
								<outline text="utils.runEveryMinute (everyMinute); "/>
								<outline text="if (callback !== undefined) {">
									<outline text="callback (config);"/>
									<outline text="}"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text="});"/>
							</outline>
						<outline text="});"/>
						</outline>
					<outline text="}"/>
					</outline>
				</outline>
			<outline text="example/package.json">
				<outline text="{">
					<outline text="&quot;name&quot;: &quot;testdaveappserver&quot;,"/>
					<outline text="&quot;description&quot;: &quot;Bare bones demo app for daveappserver package.&quot;,"/>
					<outline text="&quot;author&quot;: &quot;Dave Winer &lt;dave@scripting.com&gt;&quot;,"/>
					<outline text="&quot;license&quot;: &quot;MIT&quot;,"/>
					<outline text="&quot;version&quot;: &quot;0.4.0&quot;,"/>
					<outline text="&quot;dependencies&quot; : {">
						<outline text="&quot;daveutils&quot;: &quot;*&quot;,"/>
						<outline text="&quot;davefilesystem&quot;: &quot;*&quot;,"/>
						<outline text="&quot;daveappserver&quot;: &quot;*&quot;"/>
						<outline text="} "/>
						</outline>
					<outline text="}"/>
					</outline>
				</outline>
			<outline text="example/app.js">
				<outline text="const daveappserver = require (&quot;../appserver.js&quot;); "/>
				<outline text="const daveappserver = require (&quot;daveappserver&quot;); " isComment="true"/>
				<outline text="const utils = require (&quot;daveutils&quot;); "/>
				<outline text=""/>
				<outline text="var stats = {">
					<outline text="ctslogans: 0,"/>
					<outline text="whenLastSlogan: undefined"/>
					<outline text="};"/>
					</outline>
				<outline text="var options = {">
					<outline text="everySecond: function () {">
						<outline text="},"/>
						</outline>
					<outline text="everyMinute: function () {">
						<outline text="},"/>
						</outline>
					<outline text="httpRequest: function (theRequest) {">
						<outline text="var now = new Date ();"/>
						<outline text="function returnPlainText (s) {">
							<outline text="theRequest.httpReturn (200, &quot;text/plain&quot;, s.toString ());"/>
							<outline text="}"/>
							</outline>
						<outline text="function returnData (jstruct) {">
							<outline text="if (jstruct === undefined) {">
								<outline text="jstruct = {};"/>
								<outline text="}"/>
								</outline>
							<outline text="theRequest.httpReturn (200, &quot;application/json&quot;, utils.jsonStringify (jstruct));"/>
							<outline text="}"/>
							</outline>
						<outline text="switch (theRequest.lowerpath) {">
							<outline text="case &quot;/slogan&quot;:">
								<outline text="stats.ctslogans++;"/>
								<outline text="stats.whenLastSlogan = now;"/>
								<outline text="daveappserver.saveStats (stats);"/>
								<outline text="returnData ({slogan: utils.getRandomSnarkySlogan ()});"/>
								<outline text="return (true);"/>
								</outline>
							<outline text="}"/>
							</outline>
						<outline text="return (false); //not consumed"/>
						<outline text="}"/>
						</outline>
					<outline text="}"/>
					</outline>
				<outline text="daveappserver.start (options);"/>
				</outline>
			<outline text="example/index.html">
				<outline text="&lt;html&gt;">
					<outline text="&lt;head&gt;">
						<outline text="&lt;title&gt;[%productNameForDisplay%]&lt;/title&gt;"/>
						<outline text="&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;"/>
						<outline text="&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;"/>
						<outline text=""/>
						<outline text="&lt;!-- Facebook metadata --&gt;" isComment="true">
							<outline text="&lt;meta property=&quot;og:url&quot; content=&quot;[%metaUrl%]&quot; /&gt;"/>
							<outline text="&lt;meta property=&quot;og:type&quot; content=&quot;website&quot; /&gt;"/>
							<outline text="&lt;meta property=&quot;og:title&quot; content=&quot;[%metaTitle%]&quot; /&gt;"/>
							<outline text="&lt;meta property=&quot;og:description&quot; content=&quot;[%metaDescription%]&quot; /&gt;"/>
							<outline text="&lt;meta property=&quot;og:image&quot; content=&quot;[%metaImgUrl%]&quot; /&gt;"/>
							<outline text="&lt;meta property=&quot;og:site_name&quot; content=&quot;[%metaSiteName%]&quot; /&gt;"/>
							</outline>
						<outline text="&lt;!-- Twitter metadata --&gt;" isComment="true">
							<outline text="&lt;meta name=&quot;twitter:card&quot; content=&quot;summary_large_image&quot;&gt;"/>
							<outline text="&lt;meta name=&quot;twitter:site&quot; content=&quot;@[%metaTwitterScreenName%]&quot;&gt;"/>
							<outline text="&lt;meta name=&quot;twitter:title&quot; content=&quot;[%metaTitle%]&quot;&gt;"/>
							<outline text="&lt;meta name=&quot;twitter:url&quot; content=&quot;[%metaUrl%]&quot;&gt;"/>
							<outline text="&lt;meta name=&quot;twitter:description&quot; content=&quot;[%metaDescription%]&quot;&gt;"/>
							<outline text="&lt;meta name=&quot;twitter:image:src&quot; content=&quot;[%metaImgUrl%]&quot;&gt;"/>
							</outline>
						<outline text=""/>
						<outline text="&lt;%basicIncludes2%&gt;"/>
						<outline text=""/>
						<outline text="&lt;script src=&quot;http://fargo.io/code/storage/api.js&quot;&gt;&lt;/script&gt;" created="Thu, 08 May 2014 14:04:18 GMT" pgfnum="41269"/>
						<outline text=""/>
						<outline text="&lt;style&gt;">
							<outline text="body {">
								<outline text="font-family: Ubuntu;"/>
								<outline text="font-size: 20px;"/>
								<outline text="background-color: whitesmoke;"/>
								<outline text="}"/>
								</outline>
							<outline text=".divPageBody {">
								<outline text="margin-top: 200px;"/>
								<outline text="width: 50%;"/>
								<outline text="margin-left: auto;"/>
								<outline text="margin-right: auto;"/>
								<outline text="}"/>
								</outline>
							<outline text=".divVersionNumber {">
								<outline text="font-size: 12px;"/>
								<outline text="color: &lt;%uiTextColor%&gt;;" isComment="true"/>
								<outline text="float: right;"/>
								<outline text="padding: 19px;"/>
								<outline text="}"/>
								</outline>
							<outline text="&lt;/style&gt;"/>
							</outline>
						<outline text="&lt;script&gt;">
							<outline text="var appConsts = {">
								<outline text="productname: &quot;[%productName%]&quot;,"/>
								<outline text="productnameForDisplay: &quot;[%productNameForDisplay%]&quot;,"/>
								<outline text="version: &quot;[%version%]&quot;,"/>
								<outline text="urlTwitterServer: &quot;[%urlServerForClient%]&quot;,"/>
								<outline text="urlSocketServer: &quot;[%urlWebsocketServerForClient%]&quot;,"/>
								<outline text="flEnableLogin: [%flEnableLogin%],"/>
								<outline text="flUseSockets: true"/>
								<outline text="urlServer: &quot;http://localhost:1420/&quot;" isComment="true"/>
								<outline text="}"/>
								</outline>
							<outline text="var appPrefs = {">
								<outline text="ctStartups: 0,"/>
								<outline text="whenLastStartup: undefined,"/>
								<outline text="lastPublishedText: &quot;&quot;"/>
								<outline text="}"/>
								</outline>
							<outline text=""/>
							<outline text="var myNodeStorageApp = undefined;"/>
							<outline text=""/>
							<outline text="function prefsChanged () {">
								<outline text="myNodeStorageApp.prefsChanged ();"/>
								<outline text="}"/>
								</outline>
							<outline text="function httpRequest (url, timeout, headers, callback) {">
								<outline text="Changes" isComment="true">
									<outline text="7/20/20; 5:36:14 PM by DW">
										<outline text="Finally, I need a HTTP request routine that calls back in a standard way.">
											<outline text="function (err, data)"/>
											</outline>
										<outline text="No, I don't want to use promises."/>
										<outline text="for info about timeous see this page." isComment="true">
											<outline text="http://stackoverflow.com/questions/3543683/determine-if-ajax-error-is-a-timeout"/>
											</outline>
										</outline>
									</outline>
								<outline text="timeout = (timeout === undefined) ? 30000 : timeout;"/>
								<outline text="var jxhr = $.ajax ({ ">
									<outline text="url: url,"/>
									<outline text="dataType: &quot;text&quot;, "/>
									<outline text="headers," created="Tue, 14 May 2013 14:35:06 GMT" pgfnum="23850"/>
									<outline text="timeout"/>
									<outline text="}) "/>
									</outline>
								<outline text=".success (function (data, status) { ">
									<outline text="callback (undefined, data);"/>
									<outline text="}) "/>
									</outline>
								<outline text=".error (function (status) { ">
									<outline text="var err = {">
										<outline text="code: status.status,"/>
										<outline text="message: JSON.parse (status.responseText).message"/>
										<outline text="};"/>
										</outline>
									<outline text="callback (err);"/>
									<outline text="});"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text="function servercall (path, params, flAuthenticated, callback) {">
								<outline text="Changes" isComment="true">
									<outline text="1/11/21; 12:51:47 PM by DW">
										<outline text="New param, flAuthenticated. If true we add the oAuth info to the call. "/>
										</outline>
									</outline>
								<outline text="if (params === undefined) {">
									<outline text="params = new Object ();"/>
									<outline text="}"/>
									</outline>
								<outline text=""/>
								<outline text="if (flAuthenticated) { //1/11/21 by DW">
									<outline text="params.oauth_token = localStorage.twOauthToken;"/>
									<outline text="params.oauth_token_secret = localStorage.twOauthTokenSecret;"/>
									<outline text="}"/>
									</outline>
								<outline text=""/>
								<outline text="var url = appConsts.urlServer + path + &quot;?&quot; + twBuildParamList (params, false);" created="Sat, 09 Aug 2014 16:02:57 GMT" pgfnum="43215"/>
								<outline text="console.log (&quot;servercall: url == &quot; + url); //1/18/21 by DW"/>
								<outline text="httpRequest (url, undefined, undefined, function (err, jsontext) {">
									<outline text="if (err) {">
										<outline text="callback (err);"/>
										<outline text="}"/>
										</outline>
									<outline text="else {">
										<outline text="callback (undefined, JSON.parse (jsontext));"/>
										<outline text="}"/>
										</outline>
									<outline text="});"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text="function getSlogan (callback) {">
								<outline text="servercall (&quot;slogan&quot;, undefined, false, callback);"/>
								<outline text="}"/>
								</outline>
							<outline text="function viewSlogan () {">
								<outline text="getSlogan (function (err, jstruct) {">
									<outline text="if (err) {">
										<outline text="alertDialog (err.message);"/>
										<outline text="}"/>
										</outline>
									<outline text="else {">
										<outline text="alertDialog (jstruct.slogan);"/>
										<outline text="}"/>
										</outline>
									<outline text="});"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text="function uploadFile (path, filetext, type, flprivate, callback) {">
								<outline text="twUploadFile (path, filetext, type, flprivate, function (data) {">
									<outline text="console.log (&quot;uploadFile: data == &quot; + jsonStringify (data));"/>
									<outline text="if (callback !== undefined) {">
										<outline text="callback (data);"/>
										<outline text="}"/>
										</outline>
									<outline text="});"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text="function testUploadFile () {">
								<outline text="askDialog (&quot;Text you would like to publish:&quot;, appPrefs.lastPublishedText, &quot;Some text you'd like to publish.&quot;, function (theText, flcancel) {" created="Tue, 08 Jan 2013 01:26:19 GMT" pgfnum="16860">
									<outline text="if (!flcancel) {">
										<outline text="appPrefs.lastPublishedText = theText;"/>
										<outline text="prefsChanged ();"/>
										<outline text="uploadFile (&quot;testfile.txt&quot;, theText, &quot;text/plain&quot;, false, function (data) {">
											<outline text="window.open (data.url);"/>
											<outline text="});"/>
											</outline>
										<outline text="}"/>
										</outline>
									<outline text="});"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text=""/>
							<outline text="function updateTwitterLogin () {">
								<outline text="if (appConsts.flEnableLogin) {">
									<outline text="initTwitterMenuItems ();"/>
									<outline text="}"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text="function everySecond () {">
								<outline text="updateTwitterLogin ()"/>
								<outline text="}"/>
								</outline>
							<outline text="function startup () {">
								<outline text="console.log (&quot;startup&quot;);"/>
								<outline text="myNodeStorageApp = new nodeStorageApp (appConsts, appPrefs);"/>
								<outline text="myNodeStorageApp.everySecond = everySecond;"/>
								<outline text="myNodeStorageApp.start (function (flConnected) {">
									<outline text="if (flConnected) {">
										<outline text="appPrefs.ctStartups++;"/>
										<outline text="appPrefs.whenLastStartup = new Date ();"/>
										<outline text="prefsChanged ();"/>
										<outline text="}"/>
										</outline>
									<outline text="else {">
										<outline text="updateTwitterLogin ();"/>
										<outline text="}"/>
										</outline>
									<outline text="});"/>
									</outline>
								<outline text="}"/>
								</outline>
							<outline text="&lt;/script&gt;"/>
							</outline>
						<outline text="&lt;/head&gt;"/>
						</outline>
					<outline text="&lt;body&gt;">
						<outline text="&lt;div class=&quot;divMenubar&quot; id=&quot;idMenubar&quot;&gt;" created="Thu, 28 Mar 2013 21:39:05 GMT" pgfnum="21615">
							<outline text="&lt;div class=&quot;topbar-wrapper&quot; style=&quot;z-index: 5;&quot;&gt;">
								<outline text="&lt;div class=&quot;navbar navbar-fixed-top&quot; data-dropdown=&quot;dropdown&quot;&gt;">
									<outline text="&lt;div class=&quot;divVersionNumber&quot; id=&quot;idVersionNumber&quot;&gt;">
										<outline text="[%version%]"/>
										<outline text="&lt;/div&gt;"/>
										</outline>
									<outline text="&lt;div class=&quot;navbar-inner&quot;&gt;">
										<outline text="&lt;div class=&quot;container&quot;&gt;">
											<outline text="&lt;a class=&quot;brand&quot; onclick=&quot;clickHome ()&quot;&gt;&lt;span id=&quot;idMenuProductName&quot;&gt;[%productNameForDisplay%]&lt;/span&gt;&lt;/a&gt;"/>
											<outline text="&lt;ul class=&quot;nav&quot; id=&quot;idMainMenuList&quot;&gt;">
												<outline text="&lt;li class=&quot;dropdown&quot; id=&quot;idMainMenu&quot;&gt; ">
													<outline text="&lt;a href=&quot;#&quot; class=&quot;dropdown-toggle&quot; data-toggle=&quot;dropdown&quot;&gt;Menu&amp;nbsp;&lt;b class=&quot;caret&quot;&gt;&lt;/b&gt;&lt;/a&gt;"/>
													<outline text="&lt;ul class=&quot;dropdown-menu&quot;&gt;">
														<outline text="&lt;li&gt;&lt;a onclick=&quot;viewSlogan ()&quot;&gt;Slogan...&lt;/a&gt;&lt;/li&gt;"/>
														<outline text="&lt;li&gt;&lt;a onclick=&quot;testUploadFile ()&quot;&gt;Publish...&lt;/a&gt;&lt;/li&gt;"/>
														<outline text="&lt;li class=&quot;divider&quot;&gt;&lt;/li&gt;"/>
														<outline text="&lt;li&gt;&lt;a onclick=&quot;alertDialog ('One')&quot;&gt;One...&lt;/a&gt;&lt;/li&gt;"/>
														<outline text="&lt;li&gt;&lt;a onclick=&quot;alertDialog ('Two')&quot;&gt;Two...&lt;/a&gt;&lt;/li&gt;"/>
														<outline text="&lt;li class=&quot;divider&quot;&gt;&lt;/li&gt;"/>
														<outline text="&lt;li&gt;&lt;a onclick=&quot;alertDialog ('Three')&quot;&gt;Three...&lt;/a&gt;&lt;/li&gt;"/>
														<outline text="&lt;/ul&gt;"/>
														</outline>
													<outline text="&lt;/li&gt;"/>
													</outline>
												<outline text="&lt;/ul&gt;"/>
												</outline>
											<outline text="&lt;ul class=&quot;nav pull-right&quot;&gt;">
												<outline text="&lt;li class=&quot;dropdown&quot;&gt;">
													<outline text="&lt;a href=&quot;#&quot; class=&quot;dropdown-toggle&quot; data-toggle=&quot;dropdown&quot;&gt;&lt;span id=&quot;idTwitterIcon&quot;&gt;&lt;/span&gt;&lt;span id=&quot;idTwitterUsername&quot;&gt;&lt;/span&gt;&amp;nbsp;&lt;b class=&quot;caret&quot;&gt;&lt;/b&gt;&lt;/a&gt;"/>
													<outline text="&lt;ul class=&quot;dropdown-menu&quot;&gt;">
														<outline text="&lt;li&gt;&lt;a onclick=&quot;aboutDialog ();&quot;&gt;About &lt;span id=&quot;idMenuAboutProductName&quot;&gt;&lt;/span&gt;...&lt;/a&gt;&lt;/li&gt;"/>
														<outline text="&lt;li class=&quot;divider&quot;&gt;&lt;/li&gt;" isComment="true"/>
														<outline text="&lt;li&gt;&lt;a onclick=&quot;showPrefsDialog ();&quot;&gt;Settings...&lt;/a&gt;&lt;/li&gt;" isComment="true"/>
														<outline text="&lt;li class=&quot;divider&quot;&gt;&lt;/li&gt;"/>
														<outline text="&lt;li&gt;&lt;a onclick=&quot;fbToggleConnectCommand ();&quot; id=&quot;idFacebookConnectMenuItem&quot;&gt;&lt;/a&gt;&lt;/li&gt;" isComment="true"/>
														<outline text="&lt;li&gt;&lt;a onclick=&quot;twToggleConnectCommand ();&quot; id=&quot;idTwitterConnectMenuItem&quot;&gt;&lt;/a&gt;&lt;/li&gt;"/>
														<outline text="&lt;/ul&gt;"/>
														</outline>
													<outline text="&lt;/li&gt;"/>
													</outline>
												<outline text="&lt;/ul&gt;"/>
												</outline>
											<outline text="&lt;/div&gt;"/>
											</outline>
										<outline text="&lt;/div&gt;"/>
										</outline>
									<outline text="&lt;/div&gt;"/>
									</outline>
								<outline text="&lt;/div&gt;"/>
								</outline>
							<outline text="&lt;/div&gt;" created="Thu, 28 Mar 2013 21:39:17 GMT" pgfnum="21616"/>
							</outline>
						<outline text=""/>
						<outline text="&lt;div class=&quot;divPageBody&quot;&gt;">
							<outline text="&lt;center&gt;">
								<outline text="&lt;p&gt;This is the home page for an example app for &lt;a href=&quot;https://github.com/scripting/appServer&quot;&gt;daveAppServer&lt;/a&gt;.&lt;/p&gt;"/>
								<outline text="&lt;/center&gt;"/>
								</outline>
							<outline text="&lt;/div&gt;"/>
							</outline>
						<outline text=""/>
						<outline text="&lt;script&gt;">
							<outline text="$(document).ready (function () {">
								<outline text=""/>
								<outline text="startup ();" created="Wed, 30 Oct 2013 15:20:06 GMT" pgfnum="30656"/>
								<outline text="});"/>
								</outline>
							<outline text="&lt;/script&gt;"/>
							</outline>
						<outline text="&lt;/body&gt;"/>
						</outline>
					<outline text="&lt;/html&gt;"/>
					</outline>
				</outline>
			<outline text="example/config.json" isComment="true">
				<outline text="{">
					<outline text="&quot;productName&quot;: &quot;testDaveAppserver&quot;,"/>
					<outline text="&quot;productNameForDisplay&quot;: &quot;Example App&quot;,"/>
					<outline text=""/>
					<outline text="&quot;urlServerHomePageSource&quot;: &quot;http://scripting.com/code/daveappserver/example/index.html&quot;,"/>
					<outline text=""/>
					<outline text="&quot;prefsPath&quot;: &quot;prefs.json&quot;,"/>
					<outline text="&quot;docsPath&quot;: &quot;myDocs/&quot;,"/>
					<outline text=""/>
					<outline text="&quot;port&quot;: 1420,"/>
					<outline text="&quot;flWebsocketEnabled&quot;: true,"/>
					<outline text="&quot;websocketPort&quot;: 1421,"/>
					<outline text=""/>
					<outline text="&quot;myDomain&quot;: &quot;localhost:1420&quot;,"/>
					<outline text=""/>
					<outline text="&quot;twitterConsumerKey&quot;: &quot;abcdefghijklmnopqrstufwxy&quot;,"/>
					<outline text="&quot;twitterConsumerSecret&quot;: &quot;abcdefghijklmnopqrstufwxyabcdefghijklmnopqrstufwxy&quot;"/>
					<outline text="}"/>
					</outline>
				</outline>
			</outline>
		<outline text="build script">
			<outline text="nodeEditorSuite.utilities.buildDaveAppServer ()"/>
			</outline>
		</body>
	</opml>
